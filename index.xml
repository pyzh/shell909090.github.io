<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Shell&#39;s Home</title>
    <link>http://shell909090.org/</link>
    <description>Recent content on Shell&#39;s Home</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>CC-BY-SA4.0</copyright>
    <lastBuildDate>Tue, 16 May 2017 11:29:52 +0800</lastBuildDate>
    <atom:link href="http://shell909090.org/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>/proc/net/dev中bonding网卡的流量计算</title>
      <link>http://shell909090.org/blog/archives/2851/</link>
      <pubDate>Tue, 16 May 2017 11:29:52 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2851/</guid>
      <description>

&lt;p&gt;最近有需要，看了一下。我觉得还是讲一下，但是不讲太细了。以下代码是以4.4为基准的，不是的会特别指出。&lt;/p&gt;

&lt;h1 id=&#34;proc-net-dev的读取问题&#34;&gt;/proc/net/dev的读取问题&lt;/h1&gt;

&lt;p&gt;procfs的代码在fs/proc/proc_net.c，但是基本没干点啥事。真正的核心代码在net/core/net-procfs.c:dev_seq_show，我这里是105行。这个函数会打印个头，然后调用上面的dev_seq_printf_stats。dev_seq_printf_stats则是取设备最新信息，并打印。&lt;/p&gt;

&lt;p&gt;这里要注意的一点是，整个过程并没有锁，只是在fs/seq_file.c:seq_read上面上了一把锁。这把锁的目地更像是排斥两个进程同时读取同一个文件，而不是保证计数器正确。因此，实际上每个设备的性能计数都是单独读取的，而且读取时计数器还在持续递增。&lt;/p&gt;

&lt;p&gt;结论是什么？对于/proc/net/dev里的多个设备，做bonding加和是不可靠的。你不能假定设备1和2做了bonding，那么设备1的计数加上2的计数精确等于bonding的计数——虽然实际上就是这么算的。&lt;/p&gt;

&lt;h1 id=&#34;bonding的数据获取&#34;&gt;bonding的数据获取&lt;/h1&gt;

&lt;p&gt;我们再看dev_get_stats，这个函数里面实际上是用了ops-&amp;gt;ndo_get_stats来获得设备的数据。对于bonding来说，这个文件在drivers/net/bonding/bond_main.c:bond_get_stats。从下面的实现中，你能看到，实际上bonding网卡的计数就是用各个设备的加和。然而计算没有那么直接，用的是每个设备的当前值减去原来保存值，差值加到bonding的保存值上。换个说法就是，bonding的margin等于各个设备的margin。&lt;/p&gt;

&lt;p&gt;这个特性是由这个补丁引入的：&lt;a href=&#34;https://github.com/torvalds/linux/commit/5f0c5f73e5efaee2928c4cabcf48b03f6ba99fc8&#34;&gt;make global bonding stats more reliable&lt;/a&gt;，时间是2014年9月29日，版本是3.17.0-rc6。主要是解决bonding中去掉一块网卡的时候，计数器会掉下来的问题。在这个之前，还有两个补丁。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/torvalds/linux/commit/be1f3c2c027cc5ad735df6a45a542ed1db7ec48b&#34;&gt;Enable 64-bit net device statistics on 32-bit architectures&lt;/a&gt;的引入时间是2010年6月8日，版本是2.6.35-rc1。这个版本首次引入了64位计数器（因此，RH6里面默认配置的2.6.32内核应当是32位计数器），但是写出了bug。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/torvalds/linux/commit/28172739f0a276eb8d6ca917b3974c2edb036da3&#34;&gt;fix 64 bit counters on 32 bit arches&lt;/a&gt;的引入时间是2010年7月8日，版本同样是2.6.35-rc1。主要是解决补丁1在32位系统上非锁定读写64位计数器造成数据跨越总线宽度，导致多个CPU竞争读写时高低位被分别写入产生不一致的问题。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;由这两个补丁，我们可以简单总结出bonding的问题历史。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;在2010年，2.6.35之前，内核计数器只有32位，分分钟会出问题。实话说我完全不敢相信，有当时用过/proc/net/dev的朋友来讲讲么？&lt;/li&gt;
&lt;li&gt;2010年的时候，有短暂的bug，只影响2.6.35。这是一个开发内核，我们可以忽略。&lt;/li&gt;
&lt;li&gt;2014年，3.17.0之前。去掉一块网卡的时候，bonding计数器会掉下来。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;然而，其实问题并没有结束。如果你仔细看代码的话，会发现，bond_get_stats根本没加锁。如果两个context同时调用，有可能发生这么一个过程。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;context1读取数据并计算，计算完成后，写入bond-&amp;gt;bond_stats数据前被switch out。&lt;/li&gt;
&lt;li&gt;context2开始运算，完成计算并写入bond-&amp;gt;bond_stats。很明显，由于context2的启动时间比1晚，context2的数据结果比1大。&lt;/li&gt;
&lt;li&gt;context1被switch in，写入bond-&amp;gt;bond_stats。&lt;/li&gt;
&lt;li&gt;在随后的时间里，计数器的增长比context2和context1的差值大。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;满足上述条件的话，bonding计数器就有可能倒涨。当然，里面还有其他竟态情况，可能导致各种问题。由于这是3.17.0内核引入的，因此只会发生在这个版本之后。&lt;/p&gt;

&lt;p&gt;当然，有朋友可能会说，/proc/net/dev里有锁啊。问题是，dev_get_stats可不是只有/proc/net/dev会用，rtnetlink也有可能哦。&lt;/p&gt;

&lt;p&gt;这个问题是这个补丁修复的：&lt;a href=&#34;https://github.com/torvalds/linux/commit/fe30937b65354c7fec244caebbdaae68e28ca797&#34;&gt;fix bond_get_stats&lt;/a&gt;，时间是2016年3月18日，版本是4.5.0-rc7。在补丁的说明里，说到了这个问题。&lt;/p&gt;

&lt;p&gt;因此，我们延伸一下故障列表：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;在2010年，2.6.35之前，内核计数器只有32位，分分钟会出问题。实话说我完全不敢相信，有当时用过/proc/net/dev的朋友来讲讲么？&lt;/li&gt;
&lt;li&gt;2010年的时候，有短暂的bug，只影响2.6.35。这是一个开发内核，我们可以忽略。&lt;/li&gt;
&lt;li&gt;2014年，3.17.0之前。去掉一块网卡的时候，bonding计数器会掉下来。&lt;/li&gt;
&lt;li&gt;2014-2016年，3.17.0到4.5.0之间。多个CPU同时读写时，会发生竞争出错。&lt;/li&gt;
&lt;li&gt;2016年，4.5.0版本以上。未知。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;另外注意。并不是说3.17.0之前没有竞争问题，而是由于没有写回状态，所以竞争问题并不产生明显影响。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>SI的七个基础单位</title>
      <link>http://shell909090.org/blog/archives/2850/</link>
      <pubDate>Sun, 23 Apr 2017 12:28:30 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2850/</guid>
      <description>

&lt;p&gt;大家上学的时候，也许听老师说过这么一句话。物理学里有七个基础单位，其他单位都是这七个基础单位推导的。我以前也没怀疑过，后来在看长度定义的时候看到这么一句话——一米等于光在多少多少秒里在真空中走过的距离。我突然想到，这其实是以秒来定义米啊。&lt;/p&gt;

&lt;p&gt;后来我仔细想了一下，觉得七个基本物理单位这事有点不靠谱。我们先看一下七个基本物理单位和定义：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;米：光在真空中于1/299792458秒内行进的距离定义为1米。&lt;/li&gt;
&lt;li&gt;千克：存放于法国巴黎国际计量局的“国际千克原器”的质量定义为1千克。&lt;/li&gt;
&lt;li&gt;秒：铯133原子基态的两个超精细能阶间跃迁对应辐射的9,192,631,770个周期的持续时间定义为1秒。&lt;/li&gt;
&lt;li&gt;安培：在真空中相距为1米的两根无限长平行直导线，通以相等的恒定电流，当每米导线上所受作用力为2×10−7N时，各导线上的电流为1安培。&lt;/li&gt;
&lt;li&gt;开尔文：水的三相点与绝对零度相差的1/273.16定义为1开尔文。&lt;/li&gt;
&lt;li&gt;摩尔：所含基本微粒个数与0.012千克碳-12中所含原子个数相等的一系统物质的量定义为1摩尔。&lt;/li&gt;
&lt;li&gt;坎德拉：给定一个频率为 540.0154×1012 Hz 的单色辐射光源（黄绿色可见光）与一个方向，且该辐射源在该方向的辐射强度为 &lt;sup&gt;1&lt;/sup&gt;&amp;frasl;&lt;sub&gt;683&lt;/sub&gt; W/sr，则该辐射源在该方向的发光强度为1坎德拉。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;先特别注明一下，上述定义来自wiki&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%9B%BD%E9%99%85%E5%8D%95%E4%BD%8D%E5%88%B6&#34;&gt;国际单位制&lt;/a&gt;。下文就有一副图，把我下面要说的东西讲的非常清楚了。如果大家懒得看文字，可以去看图。但是个人觉得，那个图有点问题。&lt;/p&gt;

&lt;p&gt;这七个基本物理量有什么问题呢？我们依次来看。&lt;/p&gt;

&lt;h1 id=&#34;导出量&#34;&gt;导出量&lt;/h1&gt;

&lt;p&gt;例如刚刚的米，本质上是用光速和秒来定义的。实际上米就是秒的导出量。&lt;/p&gt;

&lt;p&gt;同样的还有安培。如果你仔细分析的话，1N = 1 kg.m/s2。所以定义本质上是用kg，m，s来导出A（更精确的说，这里也没有米什么事）。因此安培实际上是导出单位，而不是基本单位。&lt;/p&gt;

&lt;p&gt;还有坎德拉。仔细分析一下定义，Hz实际上是1/s，W是m2.kg.s-3。sr是数学常数，一个全球面等于4π个球面度。&lt;/p&gt;

&lt;h1 id=&#34;原器&#34;&gt;原器&lt;/h1&gt;

&lt;p&gt;千克的定义是，存放于法国巴黎国际计量局的“国际千克原器”的质量定义为1千克。&lt;/p&gt;

&lt;p&gt;这个定义明显的过时了，人类在米上早就摆脱了原器制。随着测量能力的飞速上涨，千克居然还使用原器定义，这不能不说是和时代不符。更糟糕的是，如上面所说，安培和坎德拉也是千克的导出量，他们又构成了SI的整个世界。所以如果千克原器略略波动，全世界的仪器都要重新校正，不限于测重仪器。而且两个大学，校正时间不一样，对同一个实验的结果可能相差很远。这又干扰到了进一步的研究。&lt;/p&gt;

&lt;h1 id=&#34;新国际单位制&#34;&gt;新国际单位制&lt;/h1&gt;

&lt;p&gt;由于上面的种种限制，因此新国际单位制被提出来。单位不再使用某人的手脚这种不靠谱的方法来定义，而是更多的采用自然现象（而且是无条件的自然现象，例如原子跃迁周期）和人为定义的常数来确定。使用这种方法来定义的单位，不需要原器，不随着时间和环境变化，能够多次产生，可以更好的反映事物的本质。&lt;/p&gt;

&lt;p&gt;例如电流。国际计量委员会的新定义，使用电量来定义安培。因为一安培的电流，一秒流过的电量是一库仑。而一库仑的电荷数是确定的，即6.2415093×10^18个。因此，新的定义采用基本电荷和秒来定义电流，这就将安培和标准电荷这种根本性的东西挂钩起来。&lt;/p&gt;

&lt;h1 id=&#34;新国际单位制下的基础单位&#34;&gt;新国际单位制下的基础单位&lt;/h1&gt;

&lt;p&gt;原本的七个单位里，刚刚已经说明了三个实际上是导出单位。因此我们还剩下四个单位：秒，千克，摩尔，开尔文。我们先说摩尔和千克。&lt;/p&gt;

&lt;p&gt;摩尔实际上是阿伏伽德罗常数的倒数。对于给定的原子，阿伏伽德罗常数越大，摩尔数越小。如果改变摩尔的定义，一摩尔为一个原子，那么Na就会变成1。当然，由于未来的定义要同今日的定义相协调，因此新的定义可能会将Na定义为常数，从而固定mol为一个特定量。&lt;/p&gt;

&lt;p&gt;而千克和摩尔的关系非常紧密。摩尔今日的定义实际上是从千克和C-12原子质量来推导Na（所以现在也是导出量，而且阿伏伽德罗常数目前会受到国际千克原器质量变动的影响）。将来mol被定义为基本量之后，kg看起来是从mol反推，即1mol的C-12重量为0.012kg（标准定义应该是XX mol的重量为1 kg，这里为了让大家看清，特意没调整）。当然，实践中采用的是硅原子球。&lt;/p&gt;

&lt;p&gt;千克的另一个定义是从普朗克常数h推导。原谅我无法解说原理，因为我看了半天没看懂。基本理念是通过天平精密平衡质量受到的引力和电磁力，从而测量普朗克常数。电磁力的基本量纲中，米和秒都有定义。在千克固定在特定值的时候，测量得到的普朗克常数值和预订相符。此时质量即为1kg。&lt;/p&gt;

&lt;p&gt;我之所以不理解是因为，从kg计算引力需要用到万有引力常数，这个常数是几大重要常数里最不精确的一个。拿这么不精确的常数来测量kg真的不要紧么？&lt;/p&gt;

&lt;p&gt;然后我们再说开尔文。开尔文目前的定义是依据自然现象来确定的，新版想要修改为更加反应热能本质。具体来说，就是固定波尔兹曼常数成为定值（1.38064852×10^-23 JK-1）。由于波尔兹曼常数实际上联系着能量和温度，当波尔兹曼常数为定值后，给定能量即可给出温度。而能量J是SI的导出单位，等于m2.kg.s-2。因此K就成为了m.kg.s的导出单位。这一修改使得K和其他物理量之间的紧密联系更加清楚的暴露。&lt;/p&gt;

&lt;p&gt;和其他单位相比，秒比较特殊。其他单位，要么是人为确定的值，和物理现象没有任何联系，例如mol。要么是通过固定的自然量从其他值中推导。例如m依据光速从s推导，kg依据原子质量从mol推导，A依据基本电荷从s推导。秒是依据特定的物理现象来测量，既不是人为定义，也不从其他物理量推导。&lt;/p&gt;

&lt;h1 id=&#34;基础物理量和由其导出的整个世界&#34;&gt;基础物理量和由其导出的整个世界&lt;/h1&gt;

&lt;p&gt;综合上面的信息，在我看来，基础的物理量有以下两个：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;秒：基本物理量，由原子跃迁时间确定。&lt;/li&gt;
&lt;li&gt;摩尔：人为认定数值，阿伏伽德罗常数个原子即一摩尔。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;基本的导出物理量有这么三个：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;米：基本物理量，通过光速，由秒导出。&lt;/li&gt;
&lt;li&gt;公斤：基本物理量，通过由原子重量，由摩尔导出。&lt;/li&gt;
&lt;li&gt;安培：基本物理量，通过基本电荷，由秒导出。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;再导出的单位有这么两个：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;开尔文：人为认定数值，通过波尔兹曼常数，由m.kg.s导出。&lt;/li&gt;
&lt;li&gt;坎德拉：人为认定数值，由m.kg.s导出。（这里似乎缺一个常数）&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;总结以上数据，又能得到以下关键物理学常数：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;原子跃迁时间。&lt;/li&gt;
&lt;li&gt;阿伏伽德罗常数。&lt;/li&gt;
&lt;li&gt;光速。&lt;/li&gt;
&lt;li&gt;原子重量。&lt;/li&gt;
&lt;li&gt;基本电荷。&lt;/li&gt;
&lt;li&gt;波尔兹曼常数。&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>模拟网络丢包延迟和TC的使用</title>
      <link>http://shell909090.org/blog/archives/2849/</link>
      <pubDate>Thu, 02 Mar 2017 12:55:37 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2849/</guid>
      <description>

&lt;h1 id=&#34;iptables方案&#34;&gt;iptables方案&lt;/h1&gt;

&lt;p&gt;这个方案纯基于iptables，不需要内核模块，对容器更加友好一些。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;iptables -A OUTPUT -d xx.xx.xx.xx -m statistic --mode random --probability 0.1 -j DROP
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;但是这个方案有个副作用。ping的时候，能看到错误“不允许的操作”。&lt;/p&gt;

&lt;h1 id=&#34;tc方案&#34;&gt;tc方案&lt;/h1&gt;

&lt;p&gt;tc方案相对比较复杂。我们先不说这些复杂的事情，先说结果。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tc qd add dev wlan0 root netem delay 100ms
tc qd change dev wlan0 root netem loss 50%
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;一个是延迟一个是丢包，一个是设定一个是修改。netem还允许你做乱序和重复。方法就不细写了。删除是这么干。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tc qd del dev wlan0 root netem
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你再用&lt;code&gt;tc qd show&lt;/code&gt;看看是不是规则已经没了？&lt;/p&gt;

&lt;h1 id=&#34;tc简述&#34;&gt;tc简述&lt;/h1&gt;

&lt;p&gt;tc是linux下面用来控制网络发包（注意是发包）的一套系统。基本的设计目标是确定优先级，限流，也有测试性的丢包之类的策略。可以配合iptables和route协同工作。&lt;/p&gt;

&lt;h1 id=&#34;基本原理&#34;&gt;基本原理&lt;/h1&gt;

&lt;p&gt;包从进入tc开始，分为多个qd(qdisc)。每个qd可以包含多个子qd，qd彼此连接形成一颗树。每个qd上可以附加filter，选择进入哪个child。如果都没命中，那就看本身规则。&lt;/p&gt;

&lt;p&gt;我们先从最简单的例子开始。将root qd改为prio。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo tc qdisc add dev eth0 root handle 1: prio
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;使用&lt;code&gt;tc qd show&lt;/code&gt;查看变化。完成后使用&lt;code&gt;sudo tc qdisc del dev eth root&lt;/code&gt;删除变化，还原为默认的pfifo_fast。&lt;/p&gt;

&lt;h1 id=&#34;使用filter来分类&#34;&gt;使用filter来分类&lt;/h1&gt;

&lt;p&gt;要分类，最低是两类。一类父，一类子。具体进入哪个sub-class可以用filter来设定。filter可以用&lt;code&gt;sudo tc filter show dev eth0&lt;/code&gt;来查看。注意，这里必须附加dev。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo tc qdisc del dev eth0 root
sudo tc qdisc add dev eth0 root handle 1: prio
sudo tc qdisc add dev eth0 parent 1:1 handle 10: netem delay 1s loss 2%
sudo tc filter del dev eth0
sudo tc filter add dev eth0 protocol ip parent 1: prio 1 u32 match ip dst 192.168.33.1 flowid 1:1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;完成后，192.168.33.1被延迟，192.168.33.2无效果。&lt;/p&gt;

&lt;p&gt;注意prio的默认bands是3，因此直接插入parent 1:4会报错。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo tc qdisc del dev eth0 root
sudo tc qdisc add dev eth0 root handle 1: prio
sudo tc qdisc add dev eth0 parent 1:3 handle 30: netem delay 1s loss 2%
sudo tc qdisc add dev eth0 parent 1:4 handle 40: sfq
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;将bands改为5问题消失。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo tc qdisc del dev eth0 root
sudo tc qdisc add dev eth0 root handle 1: prio bands 5
sudo tc qdisc add dev eth0 parent 1:3 handle 30: netem delay 1s loss 2%
sudo tc qdisc add dev eth0 parent 1:4 handle 40: sfq
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;将flowid更换为classid将会导致不起作用。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo tc qdisc del dev eth0 root
sudo tc qdisc add dev eth0 root handle 1: prio
sudo tc qdisc add dev eth0 parent 1:1 handle 10: netem delay 1s loss 2%
sudo tc filter del dev eth0
sudo tc filter add dev eth0 protocol ip parent 1: prio 1 u32 match ip dst 192.168.33.1 flowid 20:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;此时ping 192.168.33.1，结果没有延迟。&lt;/p&gt;

&lt;h1 id=&#34;多个sub-class的例子&#34;&gt;多个sub-class的例子&lt;/h1&gt;

&lt;p&gt;更复杂的例子。在prio下面分了多个sub-class。命中IP的进入延迟，未命中IP的按照prio的规则走。在prio里，使用priomap将prio映射到不同的sub-class。测试下来，ICMP报文的默认规则将是1:2。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo tc qdisc del dev eth0 root
sudo tc qdisc add dev eth0 root handle 1: prio
sudo tc qdisc add dev eth0 parent 1:1 handle 10: netem delay 1s loss 2%
sudo tc qdisc add dev eth0 parent 1:2 handle 20: netem delay 2s loss 2%
sudo tc qdisc add dev eth0 parent 1:3 handle 30: netem delay 3s loss 2%
sudo tc filter del dev eth0
sudo tc filter add dev eth0 protocol ip parent 1: prio 1 u32 match ip dst 192.168.33.1 flowid 1:1
sudo tc filter add dev eth0 protocol ip parent 1: prio 1 u32 match ip dst 192.168.33.2 flowid 1:2
sudo tc filter add dev eth0 protocol ip parent 1: prio 1 u32 match ip dst 192.168.33.3 flowid 1:3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;测试ping 192.168.33.4，结果是延迟2s。&lt;/p&gt;

&lt;h1 id=&#34;tc-filter方案&#34;&gt;tc+filter方案&lt;/h1&gt;

&lt;p&gt;运用&amp;rsquo;多个sub-class的例子&amp;rsquo;的同类方法可以用于将特定IP延迟丢包，其他走默认的pfifo_fast。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo tc qdisc del dev eth0 root
sudo tc qdisc add dev eth0 root handle 1: prio
sudo tc qdisc add dev eth0 parent 1:1 handle 10: netem delay 1s loss 2%
sudo tc qdisc add dev eth0 parent 1:2 handle 20: pfifo_fast
sudo tc filter del dev eth0
sudo tc filter add dev eth0 protocol ip parent 1: prio 1 u32 match ip dst 192.168.33.1 flowid 1:1
sudo tc filter add dev eth0 protocol ip parent 1: prio 1 u32 match ip dst 192.168.33.2 flowid 1:1
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;tc-iptables方案&#34;&gt;tc+iptables方案&lt;/h1&gt;

&lt;p&gt;我们也可以不用内置的u32 filter来做流量分离，而是先用iptables做mark，然后根据mark来做流量分离。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo tc qdisc del dev eth0 root
sudo tc qdisc add dev eth0 root handle 1: prio
sudo tc qdisc add dev eth0 parent 1:1 handle 10: netem delay 1s
sudo tc qdisc add dev eth0 parent 1:3 handle 30: netem delay 2s
sudo tc filter del dev eth0
sudo tc filter add dev eth0 parent 1:0 prio 1 protocol ip handle 5 fw flowid 1:1
sudo tc filter add dev eth0 parent 1:0 prio 0 protocol ip handle 6 fw flowid 1:3
sudo iptables -F OUTPUT -t mangle
sudo iptables -A OUTPUT -t mangle -p icmp -d 192.168.33.1 -j MARK --set-mark 5
sudo iptables -A OUTPUT -t mangle -p icmp -d 192.168.33.2 -j MARK --set-mark 6
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个方案和filter方案没有什么本质性区别，但是使用iptables完成，个人觉得更加灵活一些。&lt;/p&gt;

&lt;h1 id=&#34;清除和持久化&#34;&gt;清除和持久化&lt;/h1&gt;

&lt;p&gt;刚刚把脚本全部跑了的同学，别忘了执行一下语句清理环境。不然残留各种垃圾配置的话，上网的时候会很慢哦。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo iptables -F OUTPUT -t mangle
sudo tc filter del dev eth0
sudo tc qdisc del dev eth0 root
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果希望效果持久，可以将语句添加到rc.local里。但是实话说，我还没见过谁希望自己的系统一开机就变慢呢。QoS倒是有可能。&lt;/p&gt;

&lt;h1 id=&#34;参考&#34;&gt;参考&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;http://www.voidcn.com/blog/deyangliu/article/p-632719.html&#34;&gt;网络模拟：丢包，延迟，乱序&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.csdn.net/weiweicao0429/article/details/17578011&#34;&gt;linux 下使用 tc 模拟网络延迟和丢包&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ibm.com/developerworks/cn/linux/1412_xiehy_tc/&#34;&gt;Linux 高级流控&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>两台机器上TCP状态不一致的排查</title>
      <link>http://shell909090.org/blog/archives/2848/</link>
      <pubDate>Fri, 24 Feb 2017 11:11:24 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2848/</guid>
      <description>

&lt;h1 id=&#34;简介&#34;&gt;简介&lt;/h1&gt;

&lt;p&gt;TCP状态不一致是一种常见故障。双方的机器上列出连接，其中一方连接存在，另一方则没有任何连接。如果连接存在的一方有数据正在发送，则存在两种可能性。一种是对方收到数据报文后发现这个报文没有socket对应，于是返回一个RST，导致连接存在的一方连接直接消失。这种情况下问题很难察觉。另一种是对方（或者中间方）收到报文后直接丢弃。发送方经过一定次数（tcp_retries2，一般来说就是15分钟左右）的重试后，认为连接已死，连接会自动消失。如果tcp连接打开了keep-alive，经过7200s（具体值看socket设定），即等于有数据发送。后同。&lt;/p&gt;

&lt;p&gt;一般来说，有三种常见理由：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;RST报文丢失。在RST报文丢失时，发送方连接直接消失，接收方由于没有任何消息，因此连接始终存在。&lt;/li&gt;
&lt;li&gt;FIN报文丢失。FIN报文丢失和RST报文丢失情况类似，但是发送方会进入FIN_1状态，经过一定次数重发（tcp_orphan_retries）无回应后连接消失。&lt;/li&gt;
&lt;li&gt;内核错误。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;排障时，应当首先考虑RST报文和FIN报文丢失的情况。&lt;/p&gt;

&lt;h1 id=&#34;排障&#34;&gt;排障&lt;/h1&gt;

&lt;p&gt;首先应排除三种常见场景：&lt;/p&gt;

&lt;p&gt;场景一：接收缓冲区满。&lt;/p&gt;

&lt;p&gt;当接收缓冲区满时，FIN报文会直接丢失。这常见于接收方处理上下文堵死导致不再处理新数据的情况。特征是发送方可以观察到一定量的FIN_1状态链接（常见于接收方不处理fin报文的情形下），接收方缓冲区满，可作为特异性标识。&lt;/p&gt;

&lt;p&gt;确证方法：在接受方使用ss观察接收缓冲区。如果接收缓冲区极大而且基本不下降，配合发送方可见FIN_1状态，可以断定此场景。&lt;/p&gt;

&lt;p&gt;场景二：RST报文丢失。&lt;/p&gt;

&lt;p&gt;当中间有IDS之类（F5/SDN/firewall）的网络设备时，RST报文可能丢失。特征是发送方socket直接消失，接收方socket无任何异常。检查可见netstat -s中reset的发出和接收状况不一致，但是无法作为确证标准。&lt;/p&gt;

&lt;p&gt;确证方法：双方抓RST包，无法对齐。&lt;/p&gt;

&lt;p&gt;场景三：FIN报文丢失。&lt;/p&gt;

&lt;p&gt;情况和场景二类似，网络中有IDS类设备。但是丢失的报文是FIN。这导致发送方可见FIN_1状态，接收方缓冲区没有异常。&lt;/p&gt;

&lt;p&gt;确证方法：双方抓FIN包，无法对齐。&lt;/p&gt;

&lt;p&gt;内核错误导致的TCP状态不一致很少见，建议升级到最新内核后重测。如无法复现可以合理推测这种可能性，但是无法确证。确证需要systemtap。&lt;/p&gt;

&lt;p&gt;PS：FIN_1状态同时也受到tcp_max_orphans的限制。如果tcp_max_orphans被设定为0以清理TIME_WAIT状态的情况下，可能导致FIN_1状态很难察觉。可考虑恢复tcp_max_orphans或者干脆直接抓包诊断。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Disney Shanghai信息</title>
      <link>http://shell909090.org/blog/archives/2847/</link>
      <pubDate>Mon, 20 Feb 2017 16:32:15 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2847/</guid>
      <description>&lt;p&gt;这篇都不是攻略了，因为实在太“略”了。简单来说，就是我和老婆去了一趟Disney。&lt;/p&gt;

&lt;p&gt;很近，从16号线换11号，大概半小时就能到。路上有一堆人卖雨衣什么的。别管他们，园区里雨衣10元一件。而且以我的惨痛经历来说，雨衣并没有什么卵用。雨衣只能防住上半身，我当天穿了一件冲锋衣，也能防住。可TM当天一个浪过来，直接打湿了大半裤子。这就尼马尴尬了。于是我就去他们的厕所里，弄了一堆擦手的纸巾擦了一下——半干。另外还有两个小伙子也是类似情况，纸巾居然瞬间就见底了。可见这种现象应该是相当频繁的。然后我就带着半湿的裤子在冬天的乐园里继续玩。。。&lt;/p&gt;

&lt;p&gt;我的建议是。穿防水裤，并且尽量避开上去的那两个位置（就是开口最大的两个）。东西放在身上的时候，最好用塑料袋包一下。毕竟凡事都有万一。。。&lt;/p&gt;

&lt;p&gt;乐园里的简餐没有传说中那么贵。当时一个牛肉卷（就是和老北京鸡肉卷很像的那种卷饼，里面是五方嫩牛的内容物），大约是55元。我没记错的话，五方嫩牛也要20多，而且这还是号称全中国最良心餐饮企业之一。在正餐餐厅里随便吃一点大约是50-70。我们点了个烤猪肋排。份量很大的三根肋排骨，酱汁非常入味，也只要98。我觉得在上海随便一家中档餐厅里吃饭大概也就是这个水准了。但是有一点很奇怪的是。我们中饭和晚饭在两家餐厅吃，两家餐厅类似价钱的食物量和味道可差了好多。中午在海盗湾吃的，味道和量都不错。晚上在Peter Pan旁边的餐厅，猪肉拉面能淡出鸟，量也明显小一截。。。&lt;/p&gt;

&lt;p&gt;另外就是关于排队问题。我们去的几个地方都是一小时一小时的排队，玩其实也就几分钟。从性价比来说非常不值得。最好能搞到快速通道券。另外就是在晚上的时候，很多项目排队时间会突然缩短。我本来以为随着有些项目关门，时间应该变长的。老婆说这是因为熊孩子们被爸妈抓走了的缘故。反正晚上6点多的时候，急速光轮排队时间已经从巅峰的两小时降到15分钟了——基本就是走通道的时间。我们只在通道尽头等了两三分钟就被弹上了轨道。。。&lt;/p&gt;

&lt;p&gt;晚上和朋友聊这事。我表示我头次知道tron原来是Disney的IP。他说他更无法接受星战被米老鼠收购的事。确实，一只米老鼠说，I&amp;rsquo;m your father，然后掏出光剑来开打。想想也诡异了点。。。&lt;/p&gt;

&lt;p&gt;最后就是关于季度卡。我们很晚才知道季度卡的事，其实早知道的话会直接买季度卡。以季度周日卡为例。820左右，能去12次。就算各种因素不能每个周日都去，跑个六次不算多吧。合每次150不到。相当于花半小时跑一趟游乐园，150一次在里面玩到爽。而且如果玩这么多次的话，其实甚至可以等下午三点多出门，吃个晚饭去排15分钟一次的急速光轮，两个小时刷个6轮。。。&lt;/p&gt;

&lt;p&gt;当然，我们得知的最新消息是，最近的季度卡到3.31日截止了，下面的活动没有消息。无论如何，对于住的近的人来说，这种折扣值得关注。&lt;/p&gt;

&lt;p&gt;最后是一个个人问题，有人知道哪里有卖Disney的花栗鼠纪念品么？我们转了一圈只找到松鼠的。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>广东游记</title>
      <link>http://shell909090.org/blog/archives/2846/</link>
      <pubDate>Sun, 05 Feb 2017 15:19:50 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2846/</guid>
      <description>&lt;p&gt;广东其实没啥游记可写。论大小，这是个大城市，去过的人成千上万。论各种景点和攻略，在地的人足足可以写出一本书来（我倒是一直很想写一本上海攻略）。论美食，那更是高明到不知道哪里去了。我一个外地人，才去玩几天，有什么可写的呢？&lt;/p&gt;

&lt;p&gt;所以这次就简单记录一下广东的一些吃喝和见闻。也许不是顶好，您也就别挑剔了。这也就是一只懒猫春节没处去，随便跑了有美食的地方。如果您有什么好的馆子可以推荐在下面，一是方便读者，二是我们也许下次还有机会去。&lt;/p&gt;

&lt;p&gt;第一天下飞机，先去的西朗。飞机是晚班的，到了睡一晚，第二天坐广佛线去的祖庙。&lt;/p&gt;

&lt;p&gt;话说广佛线真是个好东西。要是有地铁能把上海苏州直接打通的话，那就方便的很了（据说规划中）。如果能再打通杭州的话，就更不得了了。高铁也很方便，但是一来票价很贵，二来要提前买票准点候车。哪像城铁这样说走就走，而且运力极大。这也亏得城市之间距离比较近，中国基建能力又足。&lt;/p&gt;

&lt;p&gt;祖庙那里没什么好说的，吃了一点双皮奶，鱼角，糯米鸡什么的。看了一场醒狮，又去岭南天地吃了一碗毋米粥。本来想吃水蛇粥，结果水蛇没有，换了牛展粥。味道也相当不错。&lt;/p&gt;

&lt;p&gt;下午去了一趟梁园，一趟南风古灶，乏善可陈。&lt;/p&gt;

&lt;p&gt;晚上我们去的另一家“行运楼”，价格略贵，菜量比较大。更适合多人去吃。我们都不够点他最著名的脆皮烧鸡，只能点了半只葱油鸡。味道比喵烧出来的好。&lt;/p&gt;

&lt;p&gt;晚上出去吃了个甜品，一杯冻鲜奶，一碗猪脚姜。冻鲜奶就是冻鲜奶，就是冰的牛奶，只是说广东这里都是用的水牛奶。我吃不出有什么区别。猪脚姜就是猪脚姜，就是猪脚烧姜。我不是很吃得惯。&lt;/p&gt;

&lt;p&gt;第二天直接去的西樵山。我本来以为爬个山而已，没想到人越来越多。后来上去一看，山顶有个宝峰寺，还有个南海观音。这就对了。才过年，拜佛的地方能不人山人海才奇怪了。我们对拜佛没兴趣，对修建时间小于500年的佛教景观更没什么兴趣。所以直接从旁边岔出去，去桃花林看桃花，茶花了。&lt;/p&gt;

&lt;p&gt;在路上的村子里有农家乐。我们看时间差不多了，素斋那里都被游客堆的人山人海的。索性在农家乐这里吃点算了。没想到这里的豉油鸡是我这几天吃的最对胃口的一顿。无他，肥鸡重油，豉油入味，对上北方人胃口，自然吃的很香。我几乎一个人吃掉了一整只鸡，猫在旁边撩了一些。&lt;/p&gt;

&lt;p&gt;晚上回来，我们去的天海酒店。这家据说是佛山本地人吃的，价格便宜上一大截。其中一道烧钳鱼（又是重油重口味），还有一道煎青椒，味道不错。青椒不辣，去子，内部塞上鱼滑，再煎过。这个做法很特殊，别处不是很常见。&lt;/p&gt;

&lt;p&gt;第三天早起去了顺德。顺德对吃很讲究，果然不假。我们去的时候不知就里，先看了清辉园再去吃饭。大家居然都收市了。好歹找了一家酒店，在西餐部吃了一点茶点，都不是顺德本地菜，十分可惜。其中一道沙姜蒸凤爪，和普通广式的凤爪味道不同，反倒有点像肉骨茶的味道。我们就在推测，肉骨茶料中就有山萘。另外就是去民信仁信转了转。两家双皮奶老店果然不同凡响，整个下午店里都是人头满满，根本没地方坐。最后好歹在美食街仁信的一个小店面里吃了一碟萝卜糕，一碗双皮奶。实话说我对双皮奶这种东西一直很腹诽，总感觉像是奶膏一样，不是很好吃。&lt;/p&gt;

&lt;p&gt;第三天晚上直接回了广州，顺德到广州的高速很快，一个小时不到就下了车（订正一下网上的资料，有说两个多小时的）。晚上就在沙面的陶然轩里面随便吃了一点。他们的菜不是很有特色，碟子和茶具倒是这两天里看到最好的一套。旁边的柜子里还摆放着老的外销瓷。&lt;/p&gt;

&lt;p&gt;第四天就在广州随便逛了一圈，石室圣心大教堂，南越王墓，北京路，还有陈家祠。这几个自己去就行，没有什么好讲。晚上我家喵念念不忘顺德美食，结果果然有了回响。在沙面有一家“有腥气”，算是顺德菜。我们在里面吃到了拆鱼粥，还有煎鱼嘴。鱼嘴更像是鱼头，也不知道正宗的顺德菜是不是这个样子。据喵说应该是小鱼。拆鱼粥很鲜。&lt;/p&gt;

&lt;p&gt;好了，这几天吃的美食大概就这些。如果你有什么推荐，请在下面留言。注意请不要推荐一些特别知名特别贵的酒店，我知道他们好吃，但是我不去是有原因的。一个是口味可能和普通市民口味有所区别，另一个就是穷。我真心的建议大家只要记住前一个原因就好，推荐我一些符合当地人口味的餐厅——同时也会便宜一些。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>phuket旅游和潜水指南</title>
      <link>http://shell909090.org/blog/archives/2845/</link>
      <pubDate>Sun, 01 Jan 2017 22:46:46 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2845/</guid>
      <description>

&lt;h1 id=&#34;大致行程&#34;&gt;大致行程&lt;/h1&gt;

&lt;p&gt;简单来说，就是带着我家猫去普吉岛玩玩。一天潜水(diving)，一天浮潜(snorkeling)，一天jungle fly，剩下的时间就是吃吃吃买买买。&lt;/p&gt;

&lt;p&gt;当然，执行下来完全不是这么回事。基本上每天都是满的，都是各种行程搭配。虽然就住在Jungceylon隔壁，却基本没有买买买的机会。吃吃吃倒是问题不大，各处都有不错的食物。不说精致，便宜好吃是起码的。更何况Jungceylon后门还有Banzaan Fresh Market，门口一到晚上就大开夜市。&lt;/p&gt;

&lt;p&gt;哦，还有说到Jungceylon，这次来了才发现，这不就是上次逛的那个大市场么？连我拍某个卖玩具妹子的哈根达斯前面的四面神像都没变化。然后顺便回翻了一下游记，发现上次住的那个Blue Marine，就在我们住的地方到FantaSea的中间，能路过。&lt;/p&gt;

&lt;p&gt;好么，净是熟人。&lt;/p&gt;

&lt;h1 id=&#34;潜水行程&#34;&gt;潜水行程&lt;/h1&gt;

&lt;p&gt;按照我的计划，第二天的行程是一整天的潜水，我家猫就去玩冲浪。&lt;/p&gt;

&lt;p&gt;这次由于是圣诞-元旦行程，因此我比较担心人多，所以提前在网上订了行程。潜店选择是&lt;a href=&#34;thailand-divers.com&#34;&gt;这家&lt;/a&gt;，原因是比较近。其实还有更近的All4Diving，在步行街上还能看到他们。但是事先咨询的结果，他们的船都是固定的，那天只有Phi Phi岛的行程。而我对Phi Phi岛的潜水又不是很感兴趣，所以还是选择了thailand divers。&lt;/p&gt;

&lt;p&gt;他们家别的还不错，有在线的客服帮你讲解和指导，能通过paypal来支付费用，基本上是挺方便的。只有一个不大不小的问题——他们没告诉我，不能在游艇上付费。所以我付了一个定金后，本来打算在游艇上支付剩余费用。结果他们前一天下午写信过来告诉我现在就必须付钱。我说我人TM在FantaSea Show现场，手机都马上要寄存了，付个毛啊。他们说那没办法。然后就在FantaSea Show手机寄存排队的时候，赶紧输入各种信息来付账。一堆信息，还全是信用卡相关的，一个不留神就容易出现盗刷，手机上又很难查证。所以搞的非常紧张。这点让我感觉很不爽，其他的还算满意啦。&lt;/p&gt;

&lt;p&gt;潜水船没什么好介绍的，双层普通潜水船，上层观光，下层内舱，后舱是四排气瓶，最后从尾部的平台上下。尾部有一个清水桶，供清洗相机什么的。两个淋浴头两个花洒，可以简单清洗或者下水前做个防雾什么的。比较有意思的倒是当天的同船。小一半是欧美人，我也分不大清楚都是哪里的。潜伴的小哥是东欧的，怀疑是俄罗斯人。因为潜导是个波兰妹子，和他用俄语聊了两句。好歹也去过一圈俄罗斯，虽然听不懂，但是大概也能分的出。船长是个泰国人，长的像是神盾里面那个独眼局长。戴一只耳环，说话泰国腔，但是很风趣。另一半则是东南亚人，以日本居多。一个很瘦的日本姐姐，拿一个超级巨大的水摄装备。三个很卡哇伊的日本妹子，清一色的涂着指甲，戴着tusa家的潜水表，估计是几个认识的朋友一起出来玩。一个日本超级帅哥，和一个没那么超级的帅哥，英语很流利。还有一对日本夫妻。中国人也不少，一对香港人，看样子是情侣或者夫妻，但是我不确定。说来好笑，日本帅哥以为船上就他们几个日本人，所以一群人在那里用日语聊天。偏偏我不会日语但是能听个大概，所以坐在旁边听他们聊斯米兰船宿。但是香港夫妇聊什么，虽然是中文，我可就完全听不懂了。另外还有三个，两女一男，看来是出来玩的朋友。男的自我介绍是教练，福建人，从新加坡过来的。&lt;/p&gt;

&lt;h1 id=&#34;潜水基本情况简介&#34;&gt;潜水基本情况简介&lt;/h1&gt;

&lt;p&gt;本次潜水主要在Andaman Sea水域，Chalong到Koh Phi Phi之间。环境洋流South to North，估计速度在2-4knots之间，部分区域可见极端高速洋流。天气晴朗（回程有雨），海面浪高0.5米左右。海水基本清澈，能见度10-20之间。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.wannadive.net/spot/Asia/Thailand/Andaman_Sea/Koh_Phuket/Koh_Dok_Mai/&#34;&gt;Koh Dok Mai&lt;/a&gt;
7° 47.786&amp;rsquo; N, 98° 31.85&amp;rsquo; E
Max: 20.4, Avg: 13.4, Vis: 15, Current: about 1 knot&lt;/p&gt;

&lt;p&gt;离码头大约20km的Andaman Sea洋面上，一个小的突出海礁。下面有垂直的海底岩壁。我们从南面下海，向东逆时针顺流绕行。原本计划是放流到北角升水，但是船长担心要在大流里升水比较麻烦，就改为顶流绕回南角升水。水下洋流还算平缓，水面流比较大。下水后可以见到成群的褐色鱼群形成瀑布，由于鱼群遮蔽岩石，无法估计规模。可见海兔(nudibranch)，海鳗(moray eel)。本次潜水因在未知海域首次潜水，配重6kg，RMV在15.7左右。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.wannadive.net/spot/Asia/Thailand/Andaman_Sea/Koh_Phuket/King_Cruiser_Wreck/&#34;&gt;King Cruiser Wreck&lt;/a&gt;
7° 48.148&amp;rsquo; N, 98° 38.599&amp;rsquo; E
Max: 25.6, Avg: 16.5, Vis: 10, Current: 3-4 knots&lt;/p&gt;

&lt;p&gt;在Koh Dok Mai向东约15km的洋面上，一艘1997年沉默的双体渡轮。船体南北走向，潜水计划是从北面的浮标下水，抓绳上下，在船体中部游览，运气好的话可以到达舰桥。由于大深度潜水，需要严格安全停留。高速洋流环境下要稳定停留，最后必须回到北面浮标处升水。因此SPG+Computer双计数，NoDec&amp;lt;10mins || SPG&amp;lt;70bars开始折返。本次潜水配重降低到5kg。&lt;/p&gt;

&lt;p&gt;下水后发现极端水面大流（还是应该说计划之中？），最低4节，加上0.5米以上大浪。下水后很多人甚至无法抓绳，也无法使用呼吸管维持呼吸，需要在水面使用气瓶全力游动。最后全部潜水员全部抓绳，就像海里被放起来的一串风筝。顺利到底，但是很多区域需要逆大流游动。海洋生物很丰富，经常可见魨类(boxfish)。有一个区域可以短暂穿越船舱门进入中间区域。（瞬间来说，是违反OW原则的。不过由于舱门距离只有1米，我觉得正常人不会在这个距离迷路或卡住。这个难度比当年的钻洞小多了）&lt;/p&gt;

&lt;p&gt;最后，我的Computer到达NoDec极限，潜伴的也在1-2分钟后到达极限（看来两者安全模型不大一样，要不就是我的平均深度比他低）。回到北角抓绳上浮，并在5米做安全停留。值得注意的是，安全停留时抓绳，深度依然维持不住，需要不停调整身体在绳子的上面或者下面。在离开5m区域后，居然深度开始保持不变，后面瞬间深度开始变小。逼的我举高绳子下沉，以避免触发上升太快警告，并且在3米和1米深度额外维持1分钟停留。在升水后我突然想到，这是因为绳子上负担了太多人之后，随洋流摆动的关系。&lt;/p&gt;

&lt;p&gt;本次潜水亦刷新了我的潜水深度记录，从24.5m到25.6m。RMV高达17.3，估计是水底高压下抗大流所致。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.wannadive.net/spot/Asia/Thailand/Andaman_Sea/Koh_Phi_Phi/Shark_Point/&#34;&gt;Shark Point&lt;/a&gt;
7° 38.03&amp;rsquo; N, 98° 48.866&amp;rsquo; E
Max: 20.1, Avg: 12.8, Vis: 10, Current: 1-3knots&lt;/p&gt;

&lt;p&gt;Shark Point在Koh Phi Phi的东南侧洋面，水面上看就是一个凸出洋面的礁石和灯塔。水下有两个礁石群，灯塔在北方的礁石群上。水下生物丰富，有部分地区有倒扣的凹陷，里面有空气，可以把手伸进去。部分区域有局部的大流，潜导甚至会放弃穿流改换路线。预计是因为洋流被礁石阻挡，聚集在某些区域所致。本次潜水RMV高达17.13，有点无法理解为何。&lt;/p&gt;

&lt;p&gt;其他就没什么好说了。新买的fin很给力，但是踢动很重，每次潜水结束都双腿酸痛，要做个足底massage。潜水结束回来时，我们正好碰到局部大雨。雨线带着一团白雾瞬间就把我们的船给罩上了，然后上层就是飘摇的大雨和冷风。一群人尖叫着躲到了底舱，然后冒雨上了码头，躲在一个小小的棚子底下等板条车。&lt;/p&gt;

&lt;h1 id=&#34;racha行程介绍&#34;&gt;Racha行程介绍&lt;/h1&gt;

&lt;p&gt;第三天是我家猫订的行程，懒猫旅游策划的皇帝岛浮潜。出发也是采用的标准普吉岛做法，定好时间在酒店里，让司机报你的房号和名字。但是他们家的司机迟到了将近半小时，打电话也无法查询到在哪。只知道你在名单上，总之会有人接你的，其余就没法控制了。这点不是让人很舒服。&lt;/p&gt;

&lt;p&gt;出发还是在chalong码头，不过先是在码头旁边的小屋里面碰头，吃晕船药，导游自我介绍。然后再走个200米到码头。剩下的和昨天差不多，脱鞋，上船。今天是一条双体单桅帆船，我分不大清楚是catboat还是sloop。团员全部都是中国人，两家带小孩的，一家带婴儿的。两对还是三对情侣/夫妻。两个女孩一组，三女一男一组，似乎都是朋友。&lt;/p&gt;

&lt;p&gt;行程很简单，先从Chalong码头出发，到普吉岛南边的珊瑚岛(Ko He)。一小时活动后，再去南边的皇帝岛(Ko Racha Yai)。到了珊瑚岛我一看，不禁失笑。这不是12年我们到的那个海岛么？我还在这里做了首次的DSD。现在拿了AOW回来，正好看看我当初看到的那些礁石的状况。上去一看，更乐了。当年椅子旁边那颗树还在，而且我还认得。还真是。。。&lt;/p&gt;

&lt;p&gt;废话不说，拿了fin去浮潜，感觉不是一个爽字得了的。估计动力比原来大了好多。但是同样，脚酸痛的问题更严重了。因为水面不能抬脚离开水面，所以打蹼距离只有原本的一半。水下生物比我预计的好了很多，最大可见30公分左右的鱼（但是离开水面还有多大不好说）。我记得的物种有蝴蝶鱼，海鳗（在一个板状物体下看到它在探头探脑）。还有一种青色的鱼，看起来像是鲷，但是无法确定。&lt;/p&gt;

&lt;p&gt;回来休息的时候，我能看到很多人在岸边准备DSD。不知道其中多少人会从此开始潜水，拿到OW/AOW，甚至更高的DM/OWSI呢？无论如何，祝他们首次潜水开心。&lt;/p&gt;

&lt;p&gt;一小时后，从珊瑚岛离开，去皇帝岛。我们是去的Patok Beach。上岸后，导游让我们把贵重物品全部带下船，但是在岸上又没有导游可以看守。导致我和猫需要轮流下水，实际游玩时间只有一半（实际上，那只怕水的猫只待了12分钟），这点不是让人很爽。不过还好，紧接着又去沙滩西边一点的礁石附近浮潜，略能弥补我的遗憾。&lt;/p&gt;

&lt;p&gt;浮潜的时候，fin可是马力全开了，整个人游动起来非常爽。当然，脚也是非常的酸。水下是大量珊瑚群，但是由于距离问题，无法仔细辨识种类，只能看到是黑色硬珊瑚。教练潜下去抓了一块蘑菇珊瑚(mashroom coral)上来给其他人看，我看多了，就没凑这个热闹。鱼类种群也很丰富，但是同样，由于距离问题，也无法辨识。这次最大的遗憾就是因为担心自由潜水(free dive)对深潜残氮的绕动导致没玩自由潜。&lt;/p&gt;

&lt;p&gt;最后，在回程的时候，由于很多人玩的很开心，所以忘记吃晕船药了。四小时药效过去，很多人就开始晕船，有个妹子还吐了。我家猫也晕，不过是回到陆地后晕了一天多。所以提醒大家，如果不确定是不是晕船，千万记得吃药。而且药不能停。&lt;/p&gt;

&lt;h1 id=&#34;jungle-fly介绍&#34;&gt;jungle fly介绍&lt;/h1&gt;

&lt;p&gt;其实这货没啥好多说的，我是潜水专长，不是爬山专长，更不会飞。但是我家猫有兴趣，所以还是去了。她选择的是&lt;a href=&#34;https://www.google.com/maps?cid=5336638845515823763&#34;&gt;这家&lt;/a&gt;。组织方会管接过来，然后给你穿戴好装备。装备会吊住你的双腿，并限制胸和背的活动范围。所以总体来说，躯干部位是受到支撑的，手脚可以乱甩没问题。然后，会有一个滑轮和一个保险绳扣在胸口的主结位置。最后再给你加一顶头盔。从失效分析来说，整个吊带上任意一根断裂不会导致人直接摔出去（断开一根的情况下故意往外面钻就是另一回事了）。滑轮故障也不会导致摔下去。但是主结位置，还有飞行绳索，都是单点。不过这些部位应当会每天检查以保证安全。或者换个说法，要解决这两个单点只有在飞行钢索旁边再吊一根平行钢索，保险绳扣背面主结，并扣平行钢索。实际上这个复杂的系统随时有可能卡住导致人受伤，反而还不如常规检查钢索。&lt;/p&gt;

&lt;p&gt;两点需要注意。一个是体重不能超过120kg，超过了可能导致很多绳索安全性不足。我去的时候就被很客气的请上了秤检查体重。当然，我是绝对不可能超过120kg的。第二个是尽量穿跟脚的，包脚趾的鞋子。这样在登山或踢到垫子的时候不会受伤。没有也没关系，他们那里有卖这种鞋子，洞洞鞋式样，200B一双，合40CNY。我觉得挺良心价的，差点也问他们买一双。&lt;/p&gt;

&lt;p&gt;开始是一段很长的登山，猫身体不大舒服，中间休息了两次，喝了两次水。然后扔上绳子后就乏善可陈了。如果你相信机械的力量，这个东西看似惊险，实际上安全性相当高。包括速降的时候。我本以为是自己抓住绳子下爬，但实际是教练负责控制你的绳子。我观察了一下绳子的控制结构，是很精巧的摩擦力装置。上面的人可以轻易的用一只手的力量控制住相当重量（我想上限是120kg）的重物停在空中。原理很简单。两个平行的钢杆之间有很多圆型的摩擦块，绳子从摩擦块之间来回穿过。当你从上面给摩擦块施加压力的时候，绳子和摩擦块之间的摩擦力就会迅速上升。摩擦块越多，阻力越大。正常体重的人下去的时候，他们用了4个。换我就用了6块。这种结构完全摒弃了用户控制不住所带来的风险。&lt;/p&gt;

&lt;p&gt;最后，要注意。如果你没有订含餐，那么需要等到吃饭的人吃完之后一起走。来的时候哪辆车，回去的时候同一辆。所以不含餐的需要等着。&lt;/p&gt;

&lt;h1 id=&#34;show评价&#34;&gt;Show评价&lt;/h1&gt;

&lt;p&gt;这次看了两个Show，FantaSea和Simon。网上的评价是各有千秋，不过我和猫的意见都是一面倒——性价比来说FantaSea比Simon要低很多。&lt;/p&gt;

&lt;p&gt;怎么说呢。同样是歌舞表演(cabaret)，FantaSea的格调让我们想起天地长白里面那一群饺子妖。而Simon，除去人妖这个因素外，基本就是老上海百乐门的歌舞。不过Simon的价格比FantaSea要低一个level，而且带接送。FantaSea虽然带餐，可是不带接送。来返出租就花了我们额外的1000B，总共加起来要700CNY以上。Simon只要180CNY，中间的差价足够随便敞开吃海鲜大餐了。&lt;/p&gt;

&lt;p&gt;哦，对了，Simon里面似乎还为了适应中国和韩国游客，加上了不少中文和韩文歌曲。一首梅花，一首阿里山的姑娘，一首阿里郎。别的不说，阿里山的姑娘字正腔圆，是正宗的中文女高音。关于这点，我总疑心是对口型。泰国这个地方，要把一群没办法去当人妖的人，培养成字正腔圆的汉语女高音。这难度似乎不是有一点高。&lt;/p&gt;

&lt;h1 id=&#34;最后一点声明&#34;&gt;最后一点声明&lt;/h1&gt;

&lt;p&gt;众所周知，潜水有风险。所以一般我不会鼓动谁来跟我潜水。如果你有兴趣，好吧，一起来潜水吧。如果没兴趣，好吧那就算了。我家猫可能是唯一例外。而且一般我出行，都会购买相应的保险（泰国一般就是AIG的东南亚乐悠游）。出来总是安全装备带齐，Computer+SMB。老潜水员入门第一课就是，命是自己的，自己要看好。&lt;/p&gt;

&lt;p&gt;这次飞机上碰到一个妹子，两次潜水（全部都是DSD）后12小时就搭乘飞机（规定是18小时），还跟我说，8小时的也坐过。。。嘛，我学潜水时，教练和我解释EAN里面1.4-1.6的区别时说过一句话，我印象很深刻。1.4是99%以上的人都没有事，1.6是99%的人都会出事。PADI的原则，就是设定一个大部分人都不会出事的门槛，这样保险公司愿意给你上保。因为出事的人，真的是“意外”。&lt;/p&gt;

&lt;p&gt;后来我看到深水潜水辅助减压的时候，会在5m使用纯氧。学过氧分压计算的应该知道，这里对应的分压是1.5，其实已经超过PADI的规定了。但是实际上，大多数人还是没有事。所以并不是说，PADI的指导原则就是绝对的。实际上一个老教练就和我说过，6小时后，正常人排氮都应该结束了，极少例外。&lt;/p&gt;

&lt;p&gt;但是违反PADI的指导原则有两重风险。首先，这可能招致万一的风险。其次，这个风险，保险是不赔的。所以，我特别警告一下所有有意愿潜水的朋友。&lt;/p&gt;

&lt;p&gt;命是自己的。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>相册</title>
      <link>http://shell909090.org/blog/album/</link>
      <pubDate>Sun, 30 Oct 2016 08:59:52 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/album/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/StpBEtzdchGGSkqx6&#34;&gt;2016俄罗斯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/XCZjUWrydgLaxoTw7&#34;&gt;2016新加坡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/qiRpiaVanC6rKJPX9&#34;&gt;2016大马&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/xUpLdjAwXuJ4T5hQA&#34;&gt;2016三亚&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/AhHzgKuE3GJoRyDY8&#34;&gt;2016泰国&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/VaZ1od1Jjjswi1218&#34;&gt;2016世纪公园&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/7gefrEA5sEADL8s78&#34;&gt;2016云南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/7AtoBfRKpUnDEsvz9&#34;&gt;2016黄山&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/7AtoBfRKpUnDEsvz9&#34;&gt;2015印度&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/tD1n5N58MCM2zCb27&#34;&gt;2015山西&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/GCC2U6EzPUh7rouX9&#34;&gt;2015山东&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/bJem6fAMJHbgWVrP8&#34;&gt;2014北海道&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/1P4yAN6RpKxiHcWF6&#34;&gt;2014新疆&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/wvyoamn4z1AqPcHTA&#34;&gt;2014潮汕&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/JuThLJRyHyz5KN4Z9&#34;&gt;2014良渚张家港&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/KdzMGzjyN6nB1fsG7&#34;&gt;2014世纪公园&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/G6PP4Sgma68psLyV9&#34;&gt;2014长白山&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/VZC2yGiAPFZqNJ3q8&#34;&gt;2013甘肃&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/zyb4Z4GEVAu6Nhhu5&#34;&gt;2013西藏&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/jscUfhQpwzwuVXVp9&#34;&gt;2013台湾&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/K9Kxfvgom1kSVTkS7&#34;&gt;2012四川&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/Jy1MeoTyaaHYpGJMA&#34;&gt;2012西安&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/Z39xJEhAZPMPTu7fA&#34;&gt;2012maldive&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/qVdYe7ihPV65Dupr6&#34;&gt;2012puhket&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/tCNcZpVsADbBd4QAA&#34;&gt;婚纱照&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/ziXrxyMYToumq6yF8&#34;&gt;2010厦门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/hkN4mrdku3UvnQFs7&#34;&gt;2009&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/GwPX1Sn1BT5cLZut6&#34;&gt;2008&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/DRs7YVCRnVcwv1cZA&#34;&gt;2007南京&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/Rtpphp2PLT2tbt1K6&#34;&gt;2007&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/5skeCJrSGnk6aUvq5&#34;&gt;2006香港&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/fnAX4HsSAnAMpdHC6&#34;&gt;2006牛栏山&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/JgGRMrVNUdwrCNta6&#34;&gt;2006&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/UtTgBNqEvvbUQMnS7&#34;&gt;2005无锡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/photos/6y2MwYnfZVjwsxdJ9&#34;&gt;2005&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>贝加尔湖旅游指南</title>
      <link>http://shell909090.org/blog/archives/2843/</link>
      <pubDate>Tue, 11 Oct 2016 13:54:05 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2843/</guid>
      <description>&lt;p&gt;首先说明，这是一篇旅游指南，里面都是旅行相关信息。想看游记的可以退散了。废话不多说，上干货吧。&lt;/p&gt;

&lt;p&gt;贝加尔湖（Baikal Lake，俄文：Озеро Байкал）位于俄罗斯的Irkutsk州（俄文：Иркутск）。一般来说，会直飞Irkutsk机场，然后再过去。Irkutsk在东八区，和北京没有时差。整个地区的通行货币是卢布（RUB，有时能看到py6一样的文字，руб，那个是俄语的卢布），兑人民币（CNY）汇率大约是1:10（1CNY = 10RUB）。整个地区通行语言是俄语。以我的体验来说，英语使用率比中国还低。这一路也算是商业旅游线路了，除了导游外，能流畅使用英语的人只有两个。大部分人只能勉强使用几个英语单词，好的可以说一下短语。所以在这个地区旅游，需要做好语言不通的准备。&lt;/p&gt;

&lt;p&gt;这里我推荐google翻译。google翻译除了能够打字翻译以外，还能将图片上的文字实时的翻译出来（不过似乎只限于打印体）。这在买东西/看招牌的时候非常管用。不过就我测试，这个好像只能在俄文和英文间互相翻译。幸好以我和喵的英语来说，没什么大区别。当然，除了google翻译以外，最好还准备一些简单的俄语单词和沟通方法（比手画脚），以备不时之需（例如没有网络情况下无法翻译）。&lt;/p&gt;

&lt;p&gt;我们已经提前买好了tele2的电话卡，在整个俄罗斯期间都可以顺利的上网和打电话，因此并不特别担心通讯问题。不过在前往Olkhon Island（俄语：Ольхон）的途中没有信号（是的，途中无信号，岛上反而有信号），有些偏远地方和地下室也是没有信号的。俄罗斯的手机很奇怪。区号是007，我们都是俄罗斯手机号，互相拨打是不加区号的。但是我们拨打别人电话的时候要加8，别人拨打我们电话的时候不要加8。非常复杂，容易搞错。我至今不理解为什么。&lt;/p&gt;

&lt;p&gt;去往俄罗斯之前，最好准备好电话卡或者其他上网设备。这样可以查询在线翻译，避免一些尴尬问题。同时，俄罗斯有时比较冷（但是最热的时候居然有30多度），所以一定要注意保暖。衣服最好是大衣+室内穿着的组合。因为很多地方有暖气，所以进入室内后需要脱下大衣。不少景点有专门的衣帽间，可以帮你把衣服挂起来。挂的时候注意提前把值钱物品和证件从衣服里拿出来。&lt;/p&gt;

&lt;p&gt;我们是报的跟团游，所以无需办理签证。后来我查了一下，中国公民团体游可以15日内免签。自由行乘客还是必须照旧出签。Irkutsk机场的出入境机构动作不是很快，普通游客可能要在移民大厅里面等很久。&lt;/p&gt;

&lt;p&gt;Baikal以自然风光而闻名，最好的季节在冬季和夏季（是的，我们去的时候反而是淡季）。Irkutsk旁边有个小镇，叫做Listvyanka（俄语：Листвянка），大约有一个多小时车程。这个小镇在Baikal Lake和Angara River（俄语：Река Ангара）的分界口附近，是Baikal Lake的重要码头，以鱼市，潜水和观光闻名。我本来在Listvyanka报了潜水（干衣）。结果下雪，潜导在船上，没回来，就没潜成。同行的一些人报了小火车的线路，从Irkutsk坐车，换小火车沿着Baikal Lake转半圈。中间会停靠几站，让你下去拍拍照。然后再上车继续。火车最后会停靠在Baikal Bay（俄文：Байкал），换渡轮游览Baikal。最后也是从Listvyanka下的船，坐车回酒店。据去过的人说挺有趣，有兴趣的可以试试。&lt;/p&gt;

&lt;p&gt;我们住在Irkutsk和Listvyanka之间的一个叫Elochka（俄语：Елочка）的松林别墅里面（说白了就是郊外，便宜）。出门100米就是Angara River的支流，窗外就是松树。路上能看到松鼠，麻雀和啄木鸟。一点都不怕人，赶都赶不走。有的时候松鼠还会跳到你身上来。但是基础设施超级差。没有饭店，只能定时去吃食堂。没有车来返市区，只能打出租。出租还算便宜，丰田的小皮卡，开到市中心半小时，也只有500RUB而已。&lt;/p&gt;

&lt;p&gt;Irkutsk基本没有出租扬招，都是打电话预订出租，而且都是俄语。但是你可以在酒店或者游客中心找到会英语的前台帮你预订。室内交通主要都是Bus。同时，室内还有几条有轨电车在运行，有兴趣的可以试试，单次乘坐15RUB左右。&lt;/p&gt;

&lt;p&gt;第三天开始，我们就从Irkutsk出发，上Olkhon Island。从Irkutsk到Olkhon Island大约是4-5小时车程，路上很多地方没有信号。窗外是大片的寒带草原，有的地方是草原和西伯利亚针阔混交林过渡区。地势连绵起伏。有的地方一马平川一望无垠，有的地方则高耸陡峭。但是战斗民族的修路很有特色。我们正常修路都是盘山，路不会是直的，以免刹车出问题。他们的路是笔直从高处冲下，又长又直，像是水上公园的滑梯。&lt;/p&gt;

&lt;p&gt;去Olkhon岛的路上，就到了Buryat人（俄文：Буряад，蒙古文：ᠪᠣᠷᠢᠶᠠᠳ）的地盘。其实Baikal Lake应该是在Irkutsk和Buryatiya的中间。Buryat是蒙古的分支，原来称呼为林中百姓，或不里牙惕。当地特色食物是什么？包子！猪肉和牛肉混合馅，加上洋葱。吃的时候要加酱油，然后吸出汤汁，再吃包子。大致吃法和小笼包非常类似。&lt;/p&gt;

&lt;p&gt;上Olkhon岛之前要坐渡轮，渡轮是人车混载渡轮。下船之后要坐当地特有的一种老式车“土坦克”（УАЗ）。岛上的路说是烂，不如说根本没有路。前面的车一压，就成了路。不过即使如此，这路况评价起来也好过去珠峰大本营的时候。&lt;/p&gt;

&lt;p&gt;岛上地势东高西低，南缓北陡。北边地势高耸，都是高高的悬崖直冲入海。西边是个平缓的坡，Khuzhir村（俄语：Поселок Хужир）和Shaman Rocks（俄语：Шаман Скалы）就在这个地方。Shaman Rocks是萨满教的圣地，也是Olkhon Island的地标。岛上的基站架设在Khuzhir村，所以远离村子的地方是没有信号的。村子里面有一个小教堂，一个学校，一个博物馆，一个邮局。&lt;/p&gt;

&lt;p&gt;他们的主路叫做ul Baykalskaya（俄语：Байкальская ул），东西走向，意思是贝加尔大街。实际上是一条尘土飞扬的烂路，而且没有铺设任何路面。西边直冲码头，铁栅栏上有个红色的五角星。导游说是因为原来这里是个捕鱼和加工厂，村子是围绕着鱼场建的。后来捕捞过量产量减少，加上自然生态保护。鱼场就被废弃了。&lt;/p&gt;

&lt;p&gt;主路的中心是学校和邮局，博物馆在学校的里面（是的，里面）。我们去的时候翻译了一下告示，似乎是周末不开，于是就没进去。邮局就在学校南边一点。你可以在村子里买到各种明信片，然后在邮局购买邮票邮回来。到中国的邮费是35RUB。&lt;/p&gt;

&lt;p&gt;博物馆西边一点，有个挺大的商店，店主是个亚洲人长相的女的，我怀疑是蒙古族（Buryat）。如果你到这家店的话，可以买一点鸡翅膀吃。我不会说俄语，所以不知道是什么的肉。不过我怀疑是火鸡肉。很好吃。同一家店里面还有格瓦斯（俄文：KBAC）。你可以稍微买一点尝尝。我家猫说和中国的版本差异很大，她喝不惯。&lt;/p&gt;

&lt;p&gt;村子里有各种奇葩项目。例如坐船出海，或者坐飞机（是的，飞机）。还有更常见的骑马和租自行车环村。不过现在是淡季，很多项目终止了。我们打听到有船，但是看湖面上波涛汹涌，回忆了一下Koh Tao上坐大船还被摇到吐了的恐怖，再看看他们的船的大小。我们明智的放弃了这个活动。&lt;/p&gt;

&lt;p&gt;常规旅游线路是南线和北线。北线包含在行程里面了，南线自费。我们跟着团去了北线。印象比较深刻的就是合波角（Cape Choboi，俄文：Мыс Хобой），整个岛的最北边。风大的能把人吹跑。我这么重的体重，居然有的时候控制不住会被吹的斜迈一步。另外就是午餐野炊的时候司机烧的鱼汤，非常鲜美。&lt;/p&gt;

&lt;p&gt;这里特别说一点，Olkhon Island旅游始终是有比较大的生态争议的。主要是垃圾处理和当地居民违法使用木材。具体可以看&lt;a href=&#34;https://en.wikipedia.org/wiki/Olkhon_Island&#34;&gt;这里&lt;/a&gt;。如果你对生态方面有特别的顾虑，请考虑这些问题。&lt;/p&gt;

&lt;p&gt;我们在Olkhon Island呆了两天就又回到Irkutsk游览，下面就是一些Irkutsk的游览建议。Irkutsk比较市中心的地方在Spasskaya Tserkov(俄文：Спасская Церковь)附近。另外就是马克思大街(Karla Marksa St，俄文：ул Карла Маркса)和列宁大街(Lenina St，俄文：ул Ленина)。我们在两者交界的Figaro吃过一次午餐，两个人吃了3000RUB多，还是挺贵的（对当地物价来说）。沙拉量极大，两个人吃一份就够了。浓汤香气扑鼻，加上蒜香面包让人胃口大开。煎鱼和羊排都很上品。比起上海来说，到确实不算贵。毕竟上海要认真吃一顿，也差不多要这个价钱。&lt;/p&gt;

&lt;p&gt;不过Irkutsk的中国菜就糟糕很多了。我们在ul Litvinova（俄文：ул Литвинова）吃的一家China Town Cafe（什么鬼），感觉上就是用马列主义指导的中国特色社会主义实践。在ul. Gorkogo（俄文：ул. Gorkogo）吃的Золотой гусь感觉上也差不多。搞笑的是他们的标语上还写，10月1,2,3，国庆大酬宾，全场八折。反倒是在Sovetskaya St（俄文：ул.Советская）附近（我没仔细记，不确定是不是这里了）的一家非常小的餐厅，中国菜做的非常地道。我们进去的时候好像看到有几个留学生在那里吃饭。&lt;/p&gt;

&lt;p&gt;Irkutsk的博物馆和教堂都很多，很多值得一看。在列宁像（Monument to Lenin，俄文：Памятник Ленин）附近就有三个博物馆。地方志博物馆（Irkutskiy Oblastnoy Kraevedcheskiy Muzey Biblioteka），美术博物馆（Irkutskiy Oblastnoy Khudozhestvennyy Muzey im. V.P.Sukacheva），还有地方博物馆（Muzey Istorii Goroda (Soldaty Otechestva)）。每个博物馆门票都不贵，100-200RUB不等。不过展品也不多，一般半小时到一个小时能看完。以我来看，这三个里面首推美术博物馆，地方志博物馆（Irkutskiy Oblastnoy Kraevedcheskiy Muzey Biblioteka）次之。Muzey Istorii Goroda (Soldaty Otechestva)就没什么意思了。&lt;/p&gt;

&lt;p&gt;教堂首推喀山圣母大教堂（Kazan church，俄文：Казанская церковь）。其他教堂非常多（例如上面说过的Spasskaya Tserkov，还有Знаменский монастырь），就不一一推荐了。&lt;/p&gt;

&lt;p&gt;Irkutsk有很多值得买的东西。自从卢布大幅贬值（大约从1:5到了1:10）之后，当地人的日子就难过了。虽然当地产的蔬菜水果肉什么的价格不变，但是国外流入的产品价格基本暴涨一倍。例如衣服，电器，iPhone什么的。可俄罗斯偏偏是个资源输出型国家，民生有关的大多数东西都是纯购入的。这使得当地居民收入快速下降。据我们导游Алена说，平均月收入大约折合2000CNY，而且很多人找不到工作。所以以前她是带团来中国旅游，现在是接中国来的旅游团。&lt;/p&gt;

&lt;p&gt;Irkutsk特产紫龙晶（charoite beads）。这东西我不大建议买。从储量上说，是挺稀有的。但是1978年才发现，目前市场情况和其他地方的储存情况非常不明朗。至于功效啥的——你说一个才研究了30多年的玩意有啥自古流传的功效可以参考的？而且这东西好运，当地价和外地价如果有大量价差，一个人随身行李里就能带上一堆走。如果喜欢，买一点戴就得了。至于要保健保值什么的，您喜欢就好。。。&lt;/p&gt;

&lt;p&gt;所以有啥可买的？&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;巧克力。我们买了一堆导游推荐的同名巧克力（Алена）。&lt;/li&gt;
&lt;li&gt;奶酪。我们不识货，随便买了两种，准备回来试试。&lt;/li&gt;
&lt;li&gt;三文鱼。这个我们买了好多，细分又有好几种。

&lt;ul&gt;
&lt;li&gt;散装：一般都是腌制的，味道稍有点咸，但是还能入口直接吃。如果有条件的话，我大概会拿来烧。&lt;/li&gt;
&lt;li&gt;袋装，油浸：口味淡一些，感觉就是烟熏三文鱼，我们就是直接食用的。&lt;/li&gt;
&lt;li&gt;烟熏三文鱼：大约是200g 16左右的样子。&lt;/li&gt;
&lt;li&gt;散装菜：很多超市提供直接熟菜销售。我们直接买了三条三文鱼腩沙拉回来，鲜嫩多汁，32左右。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;香肠：哈尔滨香肠多有名啊。这可是俄罗斯大香肠。另外，里面一定有蒜。。。&lt;/li&gt;
&lt;li&gt;冰淇淋：味道很浓，一定要试一下。&lt;/li&gt;
&lt;li&gt;Vodka：二锅头高大上版。如果家里有人喝酒，可以带一点回来。&lt;/li&gt;
&lt;li&gt;坚果：我老婆说很不错。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;有两点要注意。一是在当地超市（我们是在О&amp;rsquo;КЕЙ），很多时候要拿着会员卡才能按照上面的大字标价买东西。如果没有会员卡，会导致按照小字价格结算。两者之间的差十分明显。我们就在这里被坑了。另一个是，按照国家检验检疫标准，熟制品是不能带入境内的。即三文鱼，香肠，都不能带进来。抽真空也不行。我们反正买的不多，带就带了。万一被抽到就当丢掉。巧克力，坚果应该都没问题。奶酪不确定。Vodka好像是一人限带多少。反正我们加起来1L都没到，怎么也不会超。熟菜我想你应该不会试图带回国吧（虽然我不慎真的把熟菜带了点回来）。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>生活中总有一些小精灵会来敲你的门</title>
      <link>http://shell909090.org/blog/archives/2842/</link>
      <pubDate>Sun, 25 Sep 2016 22:24:12 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2842/</guid>
      <description>&lt;p&gt;今天家里来了个不速之客。&lt;/p&gt;

&lt;p&gt;当时我和老婆吃过饭，正在无聊，不知道去哪里玩，结果听到细微的敲门声。老婆开门出去看看，结果发现是一只灰色的短毛猫。老婆当时就觉得很惊奇，拿出家里放着的猫粮来喂猫。（我们偶尔会下楼喂流浪猫，所以家里留着一点猫粮）可是这只猫根本不吃，反而大摇大摆的走进来巡视了一圈。然后捡了个避光的地方一趴。。。&lt;/p&gt;

&lt;p&gt;。。。这霸气，您还真不认生啊。&lt;/p&gt;

&lt;p&gt;这是一只灰色的短毛猫，全身的毛蓬松水滑。到底是英短还是美短，很多朋友有分歧。我老婆说是英短。鉴于我的猫咪知识比她差的太远，所以我们就当是英短吧。下腹有一丛白毛，颜色还是雪白的。肚子鼓鼓的，像是怀了孕。见到猫粮根本不馋，可见平时吃的都是高档猫粮，而且才吃饱。进人家家一点都不认生，转了一圈，却不会去床上或者垫子上。&lt;/p&gt;

&lt;p&gt;这是一只有主的猫，而且从家里跑出来的时间不会超过半天。&lt;/p&gt;

&lt;p&gt;基于这点，老婆很快下楼问了一下物业保安。保安说刚刚一个女的抱了这只猫过来，说是楼里走失的。放在物业就走了。保安也没办法，就锁在厕所。谁知道厕所窗户有条缝，它又顺着窗户跑了。&lt;/p&gt;

&lt;p&gt;这身手，一定是从家里偷溜出来的。&lt;/p&gt;

&lt;p&gt;那问题就比较麻烦了。如果再抱给物业，想必溜掉的可能性是百分百。要找主人，也不是今天能解决的事情。所以老婆让我先问问附近的朋友，我们附近小区有没有什么地区性网站。自己则是骑车去了超市，买个小盆和猫沙给它先用着。我趁着老婆出门的功夫，发了一条推和一条朋友圈。然后才有功夫仔细观察这只猫。&lt;/p&gt;

&lt;p&gt;而这只猫趁我们刚刚在那里忙的功夫，在房间里乱转，到处乱翻，还翻倒了老婆养的花。我赶忙拿扫帚扫掉泥土，以免踩的乱七八糟的。然后唠叨了它两句，结果它坐下来，扒着我的裤子喵了一句。&lt;/p&gt;

&lt;p&gt;不知为何，我瞬间明白了它想干什么，跟着汗就下来了。&lt;/p&gt;

&lt;p&gt;女王大人您行行好，我老婆给您买猫沙去了，买来之前可千万忍住了啊。。。&lt;/p&gt;

&lt;p&gt;然后它继续。。。在家里翻箱倒柜，还差点碰倒了老婆养的插花（底下盛水的那种）。我没办法，只能一路跟着女王大人跑。然后不知为何，想起了英国内阁首席捕鼠官Larry The Cat和它的跟班们。可是这回我可没办法唠叨了，长的好看就是有优势。何况人有三急，猫想必也有。&lt;/p&gt;

&lt;p&gt;正尴尬中，老婆回来了。于是我们赶紧放好小盆，铺猫沙。女王大人一点不客气的坐了上去，然后开始刨。。。&lt;/p&gt;

&lt;p&gt;没有刨猫沙了。它不小心弄翻了猫沙盆，看来这个厕所对它来说实在是太小了。&lt;/p&gt;

&lt;p&gt;等三急落定，它又在屋子里转了一圈。看它这次的行动，像是找地方休息，而且特别偏爱有顶棚的阴暗空间。我猜它原来一定有自己的猫房子，只是我们这里没有，只能委屈它了。等它拣了个好地方趴下，我们稍微合计了一下下面怎么办。从朋友圈上面的反馈来看，很多朋友都很喜欢这只猫，甚至有朋友看到找主人三个字就直接来和我们说要养。我们倒是不担心它的去处，可是从他的种种细节来看，原主一定很宠它，现在应该很着急。可是大晚上的，就算要找也无从入手，所以先让它住着明天再说吧。&lt;/p&gt;

&lt;p&gt;结果这只猫居然主动跑过来和我买萌了。我摸了摸它的背，然后摸了摸它的肚子。这个，好像。。。老婆你来摸摸看？老婆也摸了一圈。用一种不可置信的语气说。好像，难道。。。是太肥了？&lt;/p&gt;

&lt;p&gt;卖过一圈萌，这只猫突然抬起头来四处张望。老婆没反应，我却觉得不对。细听外面，有喊人名字的声音。我赶快让老婆出去问是不是在找猫。&lt;/p&gt;

&lt;p&gt;是。&lt;/p&gt;

&lt;p&gt;什么颜色的？&lt;/p&gt;

&lt;p&gt;灰色的。&lt;/p&gt;

&lt;p&gt;好好，有平时的生活照么？进来给我们看看。&lt;/p&gt;

&lt;p&gt;有。&lt;/p&gt;

&lt;p&gt;老婆一看，就是这只。&lt;/p&gt;

&lt;p&gt;主人进门，大喊一声阿呆（还真是呆，2333），眼圈整个红了。然后猫就蹭了上去。&lt;/p&gt;

&lt;p&gt;看来是正主。&lt;/p&gt;

&lt;p&gt;主人说，他们家在我们楼上两层，这只猫是扒开窗户缝自己跑出来的（果然是惯犯）。他回家发现猫不见了，就赶快出门找，一直找到现在。结合我们知道的消息。这只猫不知如何的，到了一楼。刚跑出楼去，就被一个女的抱了回来，交给了保安。随后它就从保安的厕所逃了出来。又不知怎么的，到了我家这层。在我家门口探头探脑的敲门，给我们瞧了个正着。&lt;/p&gt;

&lt;p&gt;主人说，它运气真好。中间只要差一点点，它就很可能回不来了。我说这得说我们运气好。&lt;/p&gt;

&lt;p&gt;恩？&lt;/p&gt;

&lt;p&gt;不是每天，都有一个小精灵，带着一个完美的故事来敲门的。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>最近的阿里月饼事件</title>
      <link>http://shell909090.org/blog/archives/2841/</link>
      <pubDate>Thu, 15 Sep 2016 20:35:41 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2841/</guid>
      <description>&lt;p&gt;相信大家都听说过了，原帖在&lt;a href=&#34;https://www.zhihu.com/question/50600301&#34;&gt;这里&lt;/a&gt;。阿里的声明在&lt;a href=&#34;http://tech.sina.com.cn/i/2016-09-14/doc-ifxvyqwa3203236.shtml&#34;&gt;这里&lt;/a&gt;。我简单说一些吧。&lt;/p&gt;

&lt;p&gt;拿js秒杀抢一堆月饼是不好的，当事人也承认这点。不过哪里不好大家观点不一。当事人强调“代码错误”和“好奇测试”。从安全部的职位来说，不是说不过去。不过很明显公司不这么认为。这事扯不上价值观，也不能扯上价值观。如果要扯价值观的话，你就得想想。让一群做渗透出身，见墙上有个圈都要不信邪钻一下的人，去一个对内需要严格管理和反腐的公司。这本身三观里合了哪一观？至于提UC的同学，更是完全没提在点子上。秒杀好不好主要看杀的是谁，也就是所谓的立场决定态度。这才是核心价值观。其他价值观与此冲突者无效。&lt;/p&gt;

&lt;p&gt;这件事本身是公司内务处置，事情还得回归到公司规章制度，岗位职责和合同上去。&lt;/p&gt;

&lt;p&gt;先说最后一个被开掉的人。我不知道阿里的安全岗位有没有对内安全职责，但是一般来说，安全岗位是可以进行内部渗透的（而且这是岗位职责）。你雇了一个警卫过来让他负责安全，就不能因为人家试着从墙角的洞里面钻进来就把人家给开除——那是人家的工作。只是安全渗透通常需要协调很多事情，例如是否对线上造成影响，是否需要通知当事部门。最后那个哥们显然是没有经过协调。不过从事后并没有付钱来说，还是可以认定不是冲着月饼去的。因此事后有没有付钱这点非常重要。当事人讲法是没付，阿里的声明中未提到。&lt;/p&gt;

&lt;p&gt;如果确实没付钱，看到内部秒杀系统似乎没做反刷，写个脚本测试一下。我不知道你们管这叫什么，反正我管这个叫内部测试。这最多只能叫做工作协调有问题，既扯不上价值观，也不违反大部分正常公司的规章。当然，阿里也有可能在安全组规范里面写明了——未经备报批准不得私自进行内部渗透。那这就叫活该了。只是如果安全组有这条规范，我很怀疑内测到底能测出些什么玩意来。你看，按照规范要求，你需要一个个产品线的和对方的老大去谈，获得许可后测试。可是基本最新的，出漏洞可能性最大的系统，全都是要求赶紧上线，没时间全面考量安全性的。可黑客不归阿里的安全组规范管啊。&lt;/p&gt;

&lt;p&gt;前面一个哥们的行为则更不好说一点——他确实是冲着月饼去的——一盒。只不过由于程序故障，所以造成刷了一堆月饼出来。所以这里是两件罪——用脚本刷月饼，刷多了。&lt;/p&gt;

&lt;p&gt;脚本刷月饼是不是道德，最近有一堆朋友反复论述过了，我这里就不赘述了。在我眼里看来，用脚本去刷一盒月饼不能叫不道德。如果自动化脚本代替人操作就能叫不道德的话，你把密码存在浏览器里面，不亲自填写登录信息是不是应该叫欺诈？你看，银行让你设定密码，是希望你（这个人）去输入密码来验证自己身份的。结果你到好，用一个自动化工具帮你输入密码，欺骗银行，让他以为是你输入的。这是不是欺诈？&lt;/p&gt;

&lt;p&gt;对于程序员来说，写个脚本帮自己刷点什么太正常了。有些程序员写脚本，看到自己晚上9点后还登录在服务器上的话，就给老婆发封邮件说要加班今天回不去了。有的程序员写个程序，定期给老婆的朋友圈全部点赞。我有很多邮件甚至不是亲自读的——直接写个脚本爬下来，然后分析一下内容。有关键词才看，没有的话存档然后定期看一眼标题就行。程序员学得一身通天彻地的屠龙术，其实搞到头只有这点羊毛可以薅，你们还在那里大叫不公平。那我们每天晚上自己加码学这些技术的时候，怎么没听有人说，“这个得算加班”啊？&lt;/p&gt;

&lt;p&gt;至于刷多了的问题，这叫程序有bug——可是程序有bug不能叫程序员道德败坏吧，否则阿里的反腐难道是在HR的主持下集体抓bug的工作？&lt;/p&gt;

&lt;p&gt;当然，另一种可能就是，当事人确实是想多买几盒月饼。只不过后面事情闹大了，又不能推在临时工头上，所以只能说脚本有bug。不过据当事人声称，事后打过电话想退回多余月饼。如果这点属实，也可以排除想多刷月饼的可能。因此事后是否曾打电话要求退回月饼非常重要。同样，当事人讲法是打了，阿里的声明中未提到。&lt;/p&gt;

&lt;p&gt;所以，此人可以以技术不过关的名义辞退，但是却不应以试图刷月饼的名义辞退。因为他确实在写程序时考虑不周，对线上业务造成了影响。这在安全组工作中属于过失。没错。&lt;/p&gt;

&lt;p&gt;内务处理，很多时候只能看出发点和动机，甚至有时没什么可以参考的。要参考的话，内部多出来的月饼用秒杀，这又是合了哪条规了？要是软件公司每件事物都要参考规章来办事的话，索性还是关关门大家去应聘公务员来的快一点。很多时候本来就是没什么规章的情况下大家估摸着办，办好了就成了规章。办砸了，如果本人不是蓄意做砸的话，都属于还可以抢救一下的范畴。最多是技术不够/工作不够热情/协调能力不足/运气不好反正你办砸了怎么也得来个差评。惩治一下就行了，否则还有哪个愿意当这个出头鸟来办事？&lt;/p&gt;

&lt;p&gt;整件事情上，个人观点，觉得惩罚出手太重了。一般来说，这种事情退回月饼，通报批评，扣除当年奖金已是重罚。开除已经是在严打了。开除加上对外点名。。。要知道所谓杀人不过头点地，今天你打倒在地还要踏上一只脚，叫他永世不得翻身。。。&lt;/p&gt;

&lt;p&gt;总体结论，阿里系的安全恐怕要打个问号。即使现在没问题，将来也不排除这种可能。做内部涉安全测试的同学，就根本不能想测哪里测哪里。如果测砸了。OK，价值观不符，开除。测过了，没有线上影响，确实有bug，需要赶快修复。OK，等着你的不是嘉奖，而是仍旧价值观不符，开除。那什么最安全？当然是领导说要哪里安全就哪里安全，说要多安全就有多安全。多余的事情不要多问，不要多听，不要多想。这也确实是合了阿里的价值观，一个对内严格管理，加大力度反腐的公司，是不应当有一群看什么都不爽要亲自拆一下看看的猴子的。只是这样的安全组能起多大作用，自己想吧。&lt;/p&gt;

&lt;p&gt;最后补一下合法问题。合法性上，不好说。毕竟阿里给出的台面理由是“价值观不合”。阿里有没有把“价值观”定义为劳动雇佣合同中的一部分，我没看过合同，所以不知道。这和fb的case有差别。因为fb是把企鹅定义成了竞争对手，所以带着竞争对手的人来公司参观是明显违反保密原则的。白纸黑字毋庸置疑。更不提这也违反了H1b签证要求。而如果阿里并没有将“价值观”定义为员工要件之一，这种情况就和以“八字血型和公司名字不合”解除合同一样，属于甲方无正常理由解除合同。理应给予补偿。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>使用Jupyter制作slides</title>
      <link>http://shell909090.org/blog/archives/2840/</link>
      <pubDate>Thu, 08 Sep 2016 12:06:15 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2840/</guid>
      <description>&lt;p&gt;Jupyter是ipython notebook的新名字。可能很少有人知道，这个玩意居然还能制作slide。&lt;/p&gt;

&lt;p&gt;可能有人有印象，我做过一个markdown to slides生成器，底下用的是reveal.js。今天才发现，jupyter也有类似的功能，底层也是reveal.js。不过用起来比我自己写的东西方便多了。&lt;/p&gt;

&lt;p&gt;用法很简单。首先在View菜单里，使用Toggle Toolbar功能打开toolbar（如果已经打开就不用管）。在toolbar里能看到一项叫做Cell Toolvar的，后面一般是None。请转换为Slideshow。此时你能看到每个Cell都会多出一条来，上面有Slide Type。&lt;/p&gt;

&lt;p&gt;Slide Type有六个选项，默认是啥都没有。后面依次是Slide，Sub-Slide，Fragment，Skip，Notes。Slide和Sub-Slide是主要的选项。在reveal.js里，Slide是指左右切换的那些页，而Sub-Slide则是你切到一个Slide后，按向下逐渐出现的一些页。这类似于章和节的关系。章和章之间左右切换，节和节之间上下切换。而如果选择为默认，那么就不开新页，跟在前面的页面里。&lt;/p&gt;

&lt;p&gt;Skip的话，这个Cell会在Slide里跳过看不见。有很多时候，我们需要在Slide里嵌入Python代码。但是代码又有的时候需要做一些额外事情，我们不希望出现在Slide里面。如果将这些额外代码运行后删除，又恐怕下一次跑这个notebook跑不动。这时候就可以设定为Skip。&lt;/p&gt;

&lt;p&gt;Notes原则来说是给slide里面加注释用的。照理说在页面上按s就可以跳出提示，但是我测试下来跳出来却是空的。看了一下页面源码，确实是有东西的。可能是因为我使用的是静态的文件，而没有开启服务的关系。&lt;/p&gt;

&lt;p&gt;Fragment我也不知道干什么用的。看名字好像是代码碎片一类的，如果有知道的可以告诉我一下。&lt;/p&gt;

&lt;p&gt;最后，用nbconvert就可以把结果转换为html来用。方法是：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ipython nbconvert --to slides --reveal-prefix &amp;quot;http://cdn.jsdelivr.net/reveal.js/2.6.2&amp;quot; ...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;之所以要加reveal-prefix，是因为最新的reveal和jupyter生成的html不兼容。&lt;/p&gt;

&lt;p&gt;生成过程需要使用nodejs，记得安装。&lt;/p&gt;

&lt;p&gt;生成出来的Html就是个彻头彻尾的slide了。原则上，同一个ipynb也可以生成html或者pdf（借助reveal.js自身的pdf打印功能）。这样的话slide也有分发能力。&lt;/p&gt;

&lt;p&gt;玩的愉快。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>CentOS 6下安装Python2.7</title>
      <link>http://shell909090.org/blog/archives/2839/</link>
      <pubDate>Wed, 24 Aug 2016 15:30:59 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2839/</guid>
      <description>&lt;p&gt;我以为只有我不知道，不过看来大家都不知道。&lt;/p&gt;

&lt;p&gt;很多时候，我们还得维护CentOS 6的设备。这件事很大程度上不是我们能决定的。但是CentOS 6的默认Python是2.6，很多最新的代码无法执行。例如Django，必须使用Python2.&lt;sup&gt;7&lt;/sup&gt;&amp;frasl;&lt;sub&gt;3&lt;/sub&gt;.&lt;sup&gt;4&lt;/sup&gt;&amp;frasl;&lt;sub&gt;3&lt;/sub&gt;.5。ansible好像也要求新版本Python。&lt;/p&gt;

&lt;p&gt;作为CentOS管理员，第一个想法当然是编译。但是在CentOS 6下，不应该自行编译Python。因为Python的编译有很多坑，例如默认没有内置readline，没有内置sqlite。你不信编译了试试看？我直接从源码编译是不行的。&lt;/p&gt;

&lt;p&gt;有的同学提出想法说，可以下在srpm包然后和Python2.7的source code做compatible。但是我要说一个比这个简单的多的官方方法——RHSCL。&lt;/p&gt;

&lt;p&gt;RHSCL的全称是Red Hat Software Collections。旨在于在长期支持版本中提供最新版本的动态语言和数据库支持。&lt;a href=&#34;https://access.redhat.com/support/policy/updates/rhscl&#34;&gt;这里&lt;/a&gt;是RHSCL支持的基础工具和版本。&lt;a href=&#34;https://www.softwarecollections.org/en/scls/rhscl/python27/&#34;&gt;这里&lt;/a&gt;是说明性文档。具体方法如下：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# 1. Install a package with repository for your system:
# On CentOS, install package centos-release-scl available in CentOS repository:
$ sudo yum install centos-release-scl

# On RHEL, enable RHSCL repository for you system:
$ sudo yum-config-manager --enable rhel-server-rhscl-7-rpms

# 2. Install the collection:
$ sudo yum install python27

# 3. Start using software collections:
$ scl enable python27 bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;一定要注意最后一条指令。RHSCL并没有将Python安装到系统路径下，因此需要用特别的指令来配置环境，启用python2.7。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>gpg pubkey ID碰撞</title>
      <link>http://shell909090.org/blog/archives/2838/</link>
      <pubDate>Wed, 20 Jul 2016 00:07:59 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2838/</guid>
      <description>&lt;p&gt;昨天和朋友碰了个头，然后做了交叉签署。&lt;/p&gt;

&lt;p&gt;朋友签署完了，还没上传签署的时候。我手贱（幸好手贱）去server上update了一下我的key。结果发现多出一支key回来。&lt;/p&gt;

&lt;p&gt;纳尼？&lt;/p&gt;

&lt;p&gt;上pgp.mit.edu去搜我的邮箱，一堆key。我废弃过不少key，这就算了。有一支2014年签署的key引起了我的注意，因为ID和我的KeyID完全一致，UserID也一样。显然这是撞出来的，不过我不记得自己有做过这样的事情。&lt;/p&gt;

&lt;p&gt;下面是我的真实key的fp：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2276 57F3 6E16 9B90 4186  2EBF 29A9 7386 0914 A01A&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;这是有问题的那支key的fp：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;875D 447A E720 9037 84A0  7888 909F 2614 0914 A01A&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;可以看到，两者最后部分完全一致，这导致两者有同样的KeyID。&lt;/p&gt;

&lt;p&gt;我点进去看了一下，后面一支key完全不是我的，签的情况也乱七八糟。但是UserID显然一致。然后汗毛一竖赶紧通知朋友。朋友看了一眼，果然签错成那支假的了。&lt;/p&gt;

&lt;p&gt;我擦，我给你写我的fp是签名留念用的吗？&lt;/p&gt;

&lt;p&gt;一般来说，签名很难吊销。他要是签错了，那就麻烦大了。幸好他没上传。整个删除后重新签署，这个问题总算是顺利解决。&lt;/p&gt;

&lt;p&gt;我继续追踪，发现有趣的事来了。&lt;/p&gt;

&lt;p&gt;这个key被很多人签署，其中有个人和我的签署人KeyID和UserID又和我互相签署的某人一致。这相当于攻击者不但碰撞伪造了我和他的外观一样的Key，而且连我们的互相签署关系都伪造出来了。。。&lt;/p&gt;

&lt;p&gt;我OO了个XX的，这是想干嘛？&lt;/p&gt;

&lt;p&gt;然后，某位朋友给了我这个站点：&lt;a href=&#34;http://gwolf.org/node/4070&#34;&gt;Stop it with those short PGP key IDs!&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;里面提到了这种伪造碰撞的现象。&lt;/p&gt;

&lt;p&gt;同时，里面也提到了解决方法。&lt;/p&gt;

&lt;p&gt;首先，向你的gpg.conf里面加入&lt;code&gt;keyid-format 0xlong&lt;/code&gt;，这样可以使你的ID变为64位的长ID。碰撞难度更高，当然，也更难一眼看明白谁是谁。&lt;/p&gt;

&lt;p&gt;其次，在写程序的时候，不要使用ShortID来指明身份了，因为这种方法显然受到了攻击。继续使用ShortID可能为你程序未来的安全性埋下隐患。&lt;/p&gt;

&lt;p&gt;最后，验证fp的时候一定要用纸质传递，签署的时候一定要验证完整fp。&lt;/p&gt;

&lt;p&gt;验证fp的时候一定要用纸质传递，签署的时候一定要验证完整fp。&lt;/p&gt;

&lt;p&gt;验证fp的时候一定要用纸质传递，签署的时候一定要验证完整fp。&lt;/p&gt;

&lt;p&gt;因为很重要所以说三遍。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>更换blog声明</title>
      <link>http://shell909090.org/blog/archives/2837/</link>
      <pubDate>Wed, 22 Jun 2016 16:09:38 +0800</pubDate>
      
      <guid>http://shell909090.org/blog/archives/2837/</guid>
      <description>&lt;p&gt;在看blog的同学们应该发现了，Shell&amp;rsquo;s home整个变了个样子。&lt;/p&gt;

&lt;p&gt;这个主要是因为，我的wordpress被黑了。&lt;/p&gt;

&lt;p&gt;我的wordpress本来是托管在香港的一台主机上面，加上cdn之后，对国内外的访问效果都不错。我也一直挺满意的。在周一，我本来想把周末写好的关于潜水的blog贴出来。结果无法登录。所以我登录了cPanel去数据库里面修改密码，结果发现。。。&lt;/p&gt;

&lt;p&gt;我的数据库，整。个。都。不。见。了。&lt;/p&gt;

&lt;p&gt;WTF，这是三小？&lt;/p&gt;

&lt;p&gt;首先可以肯定，这里出了什么问题。经过对options表的检查后，我基本确定，这个blog已经不是我原来那个了。但是在数天内我没有发现这件事，而且事发时浏览一切正常。我猜测是因为我加了cache插件，而新的blog没有这个插件。所以一直没有刷cache，导致入口始终是缓存。因此只看首页一点现象都没有，在点击登录按钮后才出现问题。作为验证，我点了一下三年前的记录，结果404了。另一个朋友也验证了这个现象。所以估计推论是对的。&lt;/p&gt;

&lt;p&gt;然后是why。&lt;/p&gt;

&lt;p&gt;首先可以排除弱密码。我在wordpress上启用了24位大小写数字符号混合密码（反正是自动填写），再加上了yubikey的U2F功能，实话说我真不觉得有什么攻击者能找到我的密码进去。&lt;/p&gt;

&lt;p&gt;因此，我从cPanel里面搞到了原始浏览日志。日志显示六月八号早上8点的时候，访问帖子还是200。在某个时间点后就302了。而302是wordpress尚未安装时的标准做法，会转跳到install.php去引导你完成设定流程。也就是说，在8点多的时候，整个wordpress被突然重置。然后对照新的wordpress的初始记录，大约在9点多的时候，有人来完成了install流程。这两者之间可能有关联，也可能是重置者什么都没管就走了。我的某个读者跑过来发现这个wordpress居然没有初始化！就手欠来初始化一把。完了发现首页为什么啥反应都没有，以为自己进了蜜罐然后跑了。&lt;/p&gt;

&lt;p&gt;所以先不用参考后面wordpress的初始化信息（我也不觉得里面能找到什么有效信息，哪怕是攻击者初始化的），先查看出问题的时间点的操作。&lt;/p&gt;

&lt;p&gt;结果是一条install.php的访问，回应是200。&lt;/p&gt;

&lt;p&gt;也就是说，貌似有人绕过了install.php的锁定，重新“安装”了整个系统。&lt;/p&gt;

&lt;p&gt;当然，其中还有一点需要排除的，就是我的webhosting供应商没被黑。但是我觉得如果供应商被黑了，攻击者应该已经拿到了我的DNS管理权限，从而在乱搞我的域名了。从这点来说，wordpress有问题的概率更高。&lt;/p&gt;

&lt;p&gt;问题是，wordpress也很不应该啊。入口已经加了最严格限制，每次有更新都及时升级。而且最关键是，install.php这个文件在完成安装后就被我删除了。后面怎么又出来了？&lt;/p&gt;

&lt;p&gt;有朋友提醒，可能是我使用的某个plugin有漏洞。我想想确实是，plugin这个事情我很难去控制，有漏洞也没什么好奇怪的。&lt;/p&gt;

&lt;p&gt;然而这个安全性让我很不放心。&lt;/p&gt;

&lt;p&gt;其实前面已经在搞blog迁移到github的事了。但是因为github在中国访问很不方便，而且jekyll搞起来有点麻烦，所以一直没太大动力搞。结果被搞了这么一出，那就顺手迁了吧。反正现在还在中国的，应该已经很少用blog，更多用微信了。&lt;/p&gt;

&lt;p&gt;这里感谢adieu推荐的hugo，这个系统是golang写的，所以编译安装我很熟悉。非常容易就搞了起来。下面就是适配问题了。&lt;/p&gt;

&lt;p&gt;首先是评论。我已经把评论迁移到了disqus上面，所以不需要考虑评论问题。只要新的blog的url和老的差不多就行。同时，这样也会对前面索引了我的blog的搜索引擎比较友好。&lt;/p&gt;

&lt;p&gt;然后是原始数据。我有一份去年2月时的备份，但是没有wordpress去运行它。（试过安装，非常麻烦）很幸运的，我在网上找到了&lt;a href=&#34;https://mtik00.com/2015/07/wordpress-xml-to-hugo-md/&#34;&gt;某篇&lt;/a&gt;如何将备份数据转换为hugo数据的文章。脚本是python的，就是非常简单的xml解析转换到文件写出。所以用他的脚本做了一下简单的修改，基本就做到了保持url一致。在hugo转换后，基本就像原来的blog一样了。&lt;/p&gt;

&lt;p&gt;只有一个小问题。我的文档转换出来后是/结尾的，而原来的url最后没有/。这对搜索引擎不是什么大事——反正会自动跳过去。但是disqus就不认了。所以我做了另一个小脚本，对disqus的url做了一次mapping。&lt;/p&gt;

&lt;p&gt;最后就是把整个内容部署到github上了。这里基本没什么技巧，除了我需要用CNAME文件来让github接受我的域名。&lt;/p&gt;

&lt;p&gt;好了，现在blog就先这么放着吧。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>